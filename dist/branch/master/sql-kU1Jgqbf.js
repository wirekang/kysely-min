function e(e){return void 0===e||void 0===e}function t(e){return"string"==typeof e}function r(e){return"number"==typeof e}function o(e){return"boolean"==typeof e}function n(e){return null===e}function i(e){return e instanceof Date}function s(e){return"bigint"==typeof e}function a(e){return"undefined"!=typeof Buffer&&Buffer.isBuffer(e)}function d(e){return"function"==typeof e}function u(e){return"object"==typeof e&&null!==e}function h(e){return u(e)&&!Array.isArray(e)&&!i(e)&&!a(e)&&!function(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}(e)}function c(e){return e[e.length-1]}function p(e){return Object.freeze(e)}function l(e){return f(e)?e:[e]}function f(e){return Array.isArray(e)}function m(e){return e}function N(e,t){return f(e)&&f(t)?function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!N(e[r],t[r]))return!1;return!0}(e,t):u(e)&&u(t)?function(e,t){if(a(e)&&a(t))return o=e,n=t,0===Buffer.compare(o,n);if(i(e)&&i(t))return r=t,e.getTime()===r.getTime();var r;var o,n;return function(e,t){const r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(const o of r)if(!N(e[o],t[o]))return!1;return!0}(e,t)}(e,t):e===t}const y=p({is:e=>"IdentifierNode"===e.kind,create:e=>p({kind:"IdentifierNode",name:e})}),w=p({is:e=>"SchemableIdentifierNode"===e.kind,create:e=>p({kind:"SchemableIdentifierNode",identifier:y.create(e)}),createWithSchema:(e,t)=>p({kind:"SchemableIdentifierNode",schema:y.create(e),identifier:y.create(t)})}),g=p({is:e=>"AliasNode"===e.kind,create:(e,t)=>p({kind:"AliasNode",node:e,alias:t})}),W=p({is:e=>"TableNode"===e.kind,create:e=>p({kind:"TableNode",table:w.create(e)}),createWithSchema:(e,t)=>p({kind:"TableNode",table:w.createWithSchema(e,t)})});function q(e){return u(e)&&d(e.toOperationNode)}function O(e){return u(e)&&"expressionType"in e&&q(e)}function b(e){return u(e)&&"expression"in e&&t(e.alias)&&q(e)}const x=p({is:e=>"SelectModifierNode"===e.kind,create:(e,t)=>p({kind:"SelectModifierNode",modifier:e,of:t}),createWithExpression:e=>p({kind:"SelectModifierNode",rawModifier:e})}),k=p({is:e=>"AndNode"===e.kind,create:(e,t)=>p({kind:"AndNode",left:e,right:t})}),C=p({is:e=>"OrNode"===e.kind,create:(e,t)=>p({kind:"OrNode",left:e,right:t})}),I=p({is:e=>"OnNode"===e.kind,create:e=>p({kind:"OnNode",on:e}),cloneWithOperation:(e,t,r)=>p({...e,on:"And"===t?k.create(e.on,r):C.create(e.on,r)})}),v=p({is:e=>"JoinNode"===e.kind,create:(e,t)=>p({kind:"JoinNode",joinType:e,table:t,on:void 0}),createWithOn:(e,t,r)=>p({kind:"JoinNode",joinType:e,table:t,on:I.create(r)}),cloneWithOn:(e,t)=>p({...e,on:e.on?I.cloneWithOperation(e.on,"And",t):I.create(t)})}),T=p({is:e=>"BinaryOperationNode"===e.kind,create:(e,t,r)=>p({kind:"BinaryOperationNode",leftOperand:e,operator:t,rightOperand:r})}),S=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],B=["+","-","*","/","%","^","&","|","#","<<",">>"],R=["->","->>"],A=[...S,...B,"&&","||"],L=["exists","not exists"],E=["not","-",...L],F=[...A,...R,...E,"between","between symmetric"],D=p({is:e=>"OperatorNode"===e.kind,create:e=>p({kind:"OperatorNode",operator:e})});function M(e){return t(e)&&F.includes(e)}function J(e){return t(e)&&A.includes(e)}function Q(e){return t(e)&&S.includes(e)}function P(e){return t(e)&&B.includes(e)}function U(e){return t(e)&&R.includes(e)}const $=p({is:e=>"ColumnNode"===e.kind,create:e=>p({kind:"ColumnNode",column:y.create(e)})}),j=p({is:e=>"SelectAllNode"===e.kind,create:()=>p({kind:"SelectAllNode"})}),V=p({is:e=>"ReferenceNode"===e.kind,create:(e,t)=>p({kind:"ReferenceNode",table:t,column:e}),createSelectAll:e=>p({kind:"ReferenceNode",table:e,column:j.create()})});class K{#e;get dynamicReference(){return this.#e}get refType(){}constructor(e){this.#e=e}toOperationNode(){return oe(this.#e)}}function G(e){return u(e)&&q(e)&&t(e.dynamicReference)}const z=p({is:e=>"OrderByItemNode"===e.kind,create:(e,t)=>p({kind:"OrderByItemNode",orderBy:e,direction:t})}),H=p({is:e=>"RawNode"===e.kind,create:(e,t)=>p({kind:"RawNode",sqlFragments:p(e),parameters:p(t)}),createWithSql:e=>H.create([e],[]),createWithChild:e=>H.create(["",""],[e]),createWithChildren:e=>H.create(new Array(e.length+1).fill(""),e)});function _(e){return"asc"===e||"desc"===e}function X(e){if(2===e.length)return[Y(e[0],e[1])];if(1===e.length){const[t]=e;return Array.isArray(t)?t.map((e=>Y(e))):[Y(t)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${e.length}`)}function Y(e,t){const r=function(e){if(Jr(e))return Dr(e);if(G(e))return e.toOperationNode();const[t,r]=e.split(" ");if(r){if(!_(r))throw new Error(`Invalid order by direction: ${r}`);return z.create(se(t),Z(r))}return se(e)}(e);if(z.is(r)){if(t)throw new Error("Cannot specify direction twice!");return r}return z.create(r,Z(t))}function Z(e){if(e)return"asc"===e||"desc"===e?H.createWithSql(e):e.toOperationNode()}const ee=p({is:e=>"JSONReferenceNode"===e.kind,create:(e,t)=>p({kind:"JSONReferenceNode",reference:e,traversal:t}),cloneWithTraversal:(e,t)=>p({...e,traversal:t})}),te=p({is:e=>"JSONOperatorChainNode"===e.kind,create:e=>p({kind:"JSONOperatorChainNode",operator:e,values:p([])}),cloneWithValue:(e,t)=>p({...e,values:p([...e.values,t])})}),re=p({is:e=>"JSONPathNode"===e.kind,create:e=>p({kind:"JSONPathNode",inOperator:e,pathLegs:p([])}),cloneWithLeg:(e,t)=>p({...e,pathLegs:p([...e.pathLegs,t])})});function oe(e){return t(e)?se(e):e.toOperationNode()}function ne(e){return f(e)?e.map((e=>ie(e))):[ie(e)]}function ie(e){return Jr(e)?Dr(e):oe(e)}function se(e){if(!e.includes("."))return V.create($.create(e));const t=e.split(".").map(ue);if(3===t.length)return function(e){const[t,r,o]=e;return V.create($.create(o),W.createWithSchema(t,r))}(t);if(2===t.length)return function(e){const[t,r]=e;return V.create($.create(r),W.create(t))}(t);throw new Error(`invalid column reference ${e}`)}function ae(e){return $.create(e)}function de(e){if(e.includes(" ")){const[t,r]=e.split(" ").map(ue);if(!_(r))throw new Error(`invalid order direction "${r}" next to "${t}"`);return X([t,r])[0]}return ae(e)}function ue(e){return e.trim()}const he=p({is:e=>"PrimitiveValueListNode"===e.kind,create:e=>p({kind:"PrimitiveValueListNode",values:p([...e])})}),ce=p({is:e=>"ValueListNode"===e.kind,create:e=>p({kind:"ValueListNode",values:p(e)})}),pe=p({is:e=>"ValueNode"===e.kind,create:e=>p({kind:"ValueNode",value:e}),createImmediate:e=>p({kind:"ValueNode",value:e,immediate:!0})});function le(e){return f(e)?function(e){if(e.some(Jr))return ce.create(e.map((e=>fe(e))));return he.create(e)}(e):fe(e)}function fe(e){return Jr(e)?Dr(e):pe.create(e)}function me(e){return r(e)||o(e)||n(e)}function Ne(e){if(!me(e))throw new Error(`unsafe immediate value ${JSON.stringify(e)}`);return pe.createImmediate(e)}const ye=p({is:e=>"ParensNode"===e.kind,create:e=>p({kind:"ParensNode",node:e})});function we(e){if(3===e.length)return ge(e[0],e[1],e[2]);if(1===e.length)return fe(e[0]);throw new Error(`invalid arguments: ${JSON.stringify(e)}`)}function ge(e,t,r){return function(e){return"is"===e||"is not"===e}(t)&&be(r)?T.create(ie(e),xe(t),pe.createImmediate(r)):T.create(ie(e),xe(t),le(r))}function We(e,t,r){return T.create(ie(e),xe(t),ie(r))}function qe(t,r){return Oe(Object.entries(t).filter((([,t])=>!e(t))).map((([e,t])=>ge(e,be(t)?"is":"=",t))),r)}function Oe(e,t,r=!0){const o="and"===t?k.create:C.create;if(0===e.length)return T.create(pe.createImmediate(1),D.create("="),pe.createImmediate("and"===t?1:0));let n=ke(e[0]);for(let t=1;t<e.length;++t)n=o(n,ke(e[t]));return e.length>1&&r?ye.create(n):n}function be(e){return n(e)||o(e)}function xe(e){if(t(e)&&F.includes(e))return D.create(e);if(q(e))return e.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(e)}`)}function ke(e){return q(e)?e.toOperationNode():e}const Ce=p({is:e=>"OrderByNode"===e.kind,create:e=>p({kind:"OrderByNode",items:p([...e])}),cloneWithItems:(e,t)=>p({...e,items:p([...e.items,...t])})}),Ie=p({is:e=>"PartitionByNode"===e.kind,create:e=>p({kind:"PartitionByNode",items:p(e)}),cloneWithItems:(e,t)=>p({...e,items:p([...e.items,...t])})}),ve=p({is:e=>"OverNode"===e.kind,create:()=>p({kind:"OverNode"}),cloneWithOrderByItems:(e,t)=>p({...e,orderBy:e.orderBy?Ce.cloneWithItems(e.orderBy,t):Ce.create(t)}),cloneWithPartitionByItems:(e,t)=>p({...e,partitionBy:e.partitionBy?Ie.cloneWithItems(e.partitionBy,t):Ie.create(t)})}),Te=p({is:e=>"FromNode"===e.kind,create:e=>p({kind:"FromNode",froms:p(e)}),cloneWithFroms:(e,t)=>p({...e,froms:p([...e.froms,...t])})}),Se=p({is:e=>"GroupByNode"===e.kind,create:e=>p({kind:"GroupByNode",items:p(e)}),cloneWithItems:(e,t)=>p({...e,items:p([...e.items,...t])})}),Be=p({is:e=>"HavingNode"===e.kind,create:e=>p({kind:"HavingNode",having:e}),cloneWithOperation:(e,t,r)=>p({...e,having:"And"===t?k.create(e.having,r):C.create(e.having,r)})}),Re=p({is:e=>"SelectQueryNode"===e.kind,create:e=>p({kind:"SelectQueryNode",...e&&{with:e}}),createFrom:(e,t)=>p({kind:"SelectQueryNode",from:Te.create(e),...t&&{with:t}}),cloneWithSelections:(e,t)=>p({...e,selections:e.selections?p([...e.selections,...t]):p(t)}),cloneWithDistinctOn:(e,t)=>p({...e,distinctOn:e.distinctOn?p([...e.distinctOn,...t]):p(t)}),cloneWithFrontModifier:(e,t)=>p({...e,frontModifiers:e.frontModifiers?p([...e.frontModifiers,t]):p([t])}),cloneWithEndModifier:(e,t)=>p({...e,endModifiers:e.endModifiers?p([...e.endModifiers,t]):p([t])}),cloneWithOrderByItems:(e,t)=>p({...e,orderBy:e.orderBy?Ce.cloneWithItems(e.orderBy,t):Ce.create(t)}),cloneWithGroupByItems:(e,t)=>p({...e,groupBy:e.groupBy?Se.cloneWithItems(e.groupBy,t):Se.create(t)}),cloneWithLimit:(e,t)=>p({...e,limit:t}),cloneWithOffset:(e,t)=>p({...e,offset:t}),cloneWithFetch:(e,t)=>p({...e,fetch:t}),cloneWithHaving:(e,t)=>p({...e,having:e.having?Be.cloneWithOperation(e.having,"And",t):Be.create(t)}),cloneWithSetOperations:(e,t)=>p({...e,setOperations:e.setOperations?p([...e.setOperations,...t]):p([...t])}),cloneWithoutSelections:e=>p({...e,selections:[]}),cloneWithoutLimit:e=>p({...e,limit:void 0}),cloneWithoutOffset:e=>p({...e,offset:void 0}),cloneWithoutOrderBy:e=>p({...e,orderBy:void 0}),cloneWithoutGroupBy:e=>p({...e,groupBy:void 0})});function Ae(e,t){Object.defineProperties(e.prototype,{then:{enumerable:!1,value:()=>{throw new Error(t)}}})}class Le{#t;constructor(e){this.#t=p(e)}on(...e){return new Le({...this.#t,joinNode:v.cloneWithOn(this.#t.joinNode,we(e))})}onRef(e,t,r){return new Le({...this.#t,joinNode:v.cloneWithOn(this.#t.joinNode,We(e,t,r))})}onTrue(){return new Le({...this.#t,joinNode:v.cloneWithOn(this.#t.joinNode,H.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#t.joinNode}}Ae(Le,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const Ee=p({is:e=>"PartitionByItemNode"===e.kind,create:e=>p({kind:"PartitionByItemNode",partitionBy:e})});function Fe(e){return ne(e).map(Ee.create)}class De{#t;constructor(e){this.#t=p(e)}orderBy(e,t){return new De({overNode:ve.cloneWithOrderByItems(this.#t.overNode,X([e,t]))})}partitionBy(e){return new De({overNode:ve.cloneWithPartitionByItems(this.#t.overNode,Fe(e))})}$call(e){return e(this)}toOperationNode(){return this.#t.overNode}}Ae(De,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const Me=p({is:e=>"SelectionNode"===e.kind,create:e=>p({kind:"SelectionNode",selection:e}),createSelectAll:()=>p({kind:"SelectionNode",selection:j.create()}),createSelectAllFromTable:e=>p({kind:"SelectionNode",selection:V.createSelectAll(e)})});function Je(e){return d(e)?Je(e(Fr())):f(e)?e.map((e=>Qe(e))):[Qe(e)]}function Qe(e){return t(e)?Me.create(function(e){const t=" as ";if(e.includes(t)){const[r,o]=e.split(t).map(ue);return g.create(se(r),y.create(o))}return se(e)}(e)):G(e)?Me.create(e.toOperationNode()):Me.create(Mr(e))}function Pe(e){return e?Array.isArray(e)?e.map(Ue):[Ue(e)]:[Me.createSelectAll()]}function Ue(e){if(t(e))return Me.createSelectAllFromTable($r(e));throw new Error(`invalid value selectAll expression: ${JSON.stringify(e)}`)}const $e=p({is:e=>"ValuesNode"===e.kind,create:e=>p({kind:"ValuesNode",values:p(e)})}),je=p({is:e=>"DefaultInsertValueNode"===e.kind,create:()=>p({kind:"DefaultInsertValueNode"})});function Ve(t){const r=d(t)?t(Fr()):t;return function(t){const r=function(e){const t=new Map;for(const r of e){const e=Object.keys(r);for(const o of e)t.has(o)||void 0===r[o]||t.set(o,t.size)}return t}(t);return[p([...r.keys()].map($.create)),$e.create(t.map((t=>function(t,r){const o=Object.keys(t),n=Array.from({length:r.size});let i=!1;for(const s of o){const o=r.get(s);if(e(o))continue;const a=t[s];(e(a)||Jr(a))&&(i=!0),n[o]=a}const s=o.length<r.size;if(s||i){const t=je.create();return ce.create(n.map((r=>e(r)?t:fe(r))))}return he.create(n)}(t,r))))]}(f(r)?r:p([r]))}const Ke=p({is:e=>"InsertQueryNode"===e.kind,create:(e,t,r)=>p({kind:"InsertQueryNode",into:e,...t&&{with:t},replace:r}),createWithoutInto:()=>p({kind:"InsertQueryNode"}),cloneWith:(e,t)=>p({...e,...t})}),Ge=p({is:e=>"UpdateQueryNode"===e.kind,create:(e,t)=>p({kind:"UpdateQueryNode",table:e,...t&&{with:t}}),createWithoutTable:()=>p({kind:"UpdateQueryNode"}),cloneWithFromItems:(e,t)=>p({...e,from:e.from?Te.cloneWithFroms(e.from,t):Te.create(t)}),cloneWithUpdates:(e,t)=>p({...e,updates:e.updates?p([...e.updates,...t]):t}),cloneWithLimit:(e,t)=>p({...e,limit:t})}),ze=p({is:e=>"UsingNode"===e.kind,create:e=>p({kind:"UsingNode",tables:p(e)}),cloneWithTables:(e,t)=>p({...e,tables:p([...e.tables,...t])})}),He=p({is:e=>"DeleteQueryNode"===e.kind,create:(e,t)=>p({kind:"DeleteQueryNode",from:Te.create(e),...t&&{with:t}}),cloneWithOrderByItems:(e,t)=>p({...e,orderBy:e.orderBy?Ce.cloneWithItems(e.orderBy,t):Ce.create(t)}),cloneWithoutOrderBy:e=>p({...e,orderBy:void 0}),cloneWithLimit:(e,t)=>p({...e,limit:t}),cloneWithoutLimit:e=>p({...e,limit:void 0}),cloneWithUsing:(e,t)=>p({...e,using:void 0!==e.using?ze.cloneWithTables(e.using,t):ze.create(t)})}),_e=p({is:e=>"WhereNode"===e.kind,create:e=>p({kind:"WhereNode",where:e}),cloneWithOperation:(e,t,r)=>p({...e,where:"And"===t?k.create(e.where,r):C.create(e.where,r)})}),Xe=p({is:e=>"ReturningNode"===e.kind,create:e=>p({kind:"ReturningNode",selections:p(e)}),cloneWithSelections:(e,t)=>p({...e,selections:e.selections?p([...e.selections,...t]):p(t)})}),Ye=p({is:e=>"ExplainNode"===e.kind,create:(e,t)=>p({kind:"ExplainNode",format:e,options:t})}),Ze=p({is:e=>"WhenNode"===e.kind,create:e=>p({kind:"WhenNode",condition:e}),cloneWithResult:(e,t)=>p({...e,result:t})}),et=p({is:e=>"MergeQueryNode"===e.kind,create:(e,t)=>p({kind:"MergeQueryNode",into:e,...t&&{with:t}}),cloneWithUsing:(e,t)=>p({...e,using:t}),cloneWithWhen:(e,t)=>p({...e,whens:e.whens?p([...e.whens,t]):p([t])}),cloneWithThen:(e,t)=>p({...e,whens:e.whens?p([...e.whens.slice(0,-1),Ze.cloneWithResult(e.whens[e.whens.length-1],t)]):void 0})}),tt=p({is:e=>"OutputNode"===e.kind,create:e=>p({kind:"OutputNode",selections:p(e)}),cloneWithSelections:(e,t)=>p({...e,selections:e.selections?p([...e.selections,...t]):p(t)})}),rt=p({is:e=>Re.is(e)||Ke.is(e)||Ge.is(e)||He.is(e)||et.is(e),cloneWithWhere:(e,t)=>p({...e,where:e.where?_e.cloneWithOperation(e.where,"And",t):_e.create(t)}),cloneWithJoin:(e,t)=>p({...e,joins:e.joins?p([...e.joins,t]):p([t])}),cloneWithReturning:(e,t)=>p({...e,returning:e.returning?Xe.cloneWithSelections(e.returning,t):Xe.create(t)}),cloneWithoutReturning:e=>p({...e,returning:void 0}),cloneWithoutWhere:e=>p({...e,where:void 0}),cloneWithExplain:(e,t,r)=>p({...e,explain:Ye.create(t,r?.toOperationNode())}),cloneWithTop:(e,t)=>p({...e,top:t}),cloneWithOutput:(e,t)=>p({...e,output:e.output?tt.cloneWithSelections(e.output,t):tt.create(t)})}),ot=p({is:e=>"ColumnUpdateNode"===e.kind,create:(e,t)=>p({kind:"ColumnUpdateNode",column:e,value:t})});function nt(...e){return 2===e.length?[ot.create(ie(e[0]),fe(e[1]))]:it(e[0])}function it(e){const t=d(e)?e(Fr()):e;return Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>ot.create($.create(e),fe(t))))}const st=p({is:e=>"OnDuplicateKeyNode"===e.kind,create:e=>p({kind:"OnDuplicateKeyNode",updates:e})});class at{insertId;numInsertedOrUpdatedRows;constructor(e,t){this.insertId=e,this.numInsertedOrUpdatedRows=t}}class dt extends Error{node;constructor(e){super("no result"),this.node=e}}function ut(e){return Object.prototype.hasOwnProperty.call(e,"prototype")}const ht=p({is:e=>"OnConflictNode"===e.kind,create:()=>p({kind:"OnConflictNode"}),cloneWith:(e,t)=>p({...e,...t}),cloneWithIndexWhere:(e,t)=>p({...e,indexWhere:e.indexWhere?_e.cloneWithOperation(e.indexWhere,"And",t):_e.create(t)}),cloneWithIndexOrWhere:(e,t)=>p({...e,indexWhere:e.indexWhere?_e.cloneWithOperation(e.indexWhere,"Or",t):_e.create(t)}),cloneWithUpdateWhere:(e,t)=>p({...e,updateWhere:e.updateWhere?_e.cloneWithOperation(e.updateWhere,"And",t):_e.create(t)}),cloneWithUpdateOrWhere:(e,t)=>p({...e,updateWhere:e.updateWhere?_e.cloneWithOperation(e.updateWhere,"Or",t):_e.create(t)}),cloneWithoutIndexWhere:e=>p({...e,indexWhere:void 0}),cloneWithoutUpdateWhere:e=>p({...e,updateWhere:void 0})});class ct{#t;constructor(e){this.#t=p(e)}column(e){const t=$.create(e);return new ct({...this.#t,onConflictNode:ht.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?p([...this.#t.onConflictNode.columns,t]):p([t])})})}columns(e){const t=e.map($.create);return new ct({...this.#t,onConflictNode:ht.cloneWith(this.#t.onConflictNode,{columns:this.#t.onConflictNode.columns?p([...this.#t.onConflictNode.columns,...t]):p(t)})})}constraint(e){return new ct({...this.#t,onConflictNode:ht.cloneWith(this.#t.onConflictNode,{constraint:y.create(e)})})}expression(e){return new ct({...this.#t,onConflictNode:ht.cloneWith(this.#t.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new ct({...this.#t,onConflictNode:ht.cloneWithIndexWhere(this.#t.onConflictNode,we(e))})}whereRef(e,t,r){return new ct({...this.#t,onConflictNode:ht.cloneWithIndexWhere(this.#t.onConflictNode,We(e,t,r))})}clearWhere(){return new ct({...this.#t,onConflictNode:ht.cloneWithoutIndexWhere(this.#t.onConflictNode)})}doNothing(){return new pt({...this.#t,onConflictNode:ht.cloneWith(this.#t.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new lt({...this.#t,onConflictNode:ht.cloneWith(this.#t.onConflictNode,{updates:it(e)})})}$call(e){return e(this)}}Ae(ct,"don't await OnConflictBuilder instances.");class pt{#t;constructor(e){this.#t=p(e)}toOperationNode(){return this.#t.onConflictNode}}Ae(pt,"don't await OnConflictDoNothingBuilder instances.");class lt{#t;constructor(e){this.#t=p(e)}where(...e){return new lt({...this.#t,onConflictNode:ht.cloneWithUpdateWhere(this.#t.onConflictNode,we(e))})}whereRef(e,t,r){return new lt({...this.#t,onConflictNode:ht.cloneWithUpdateWhere(this.#t.onConflictNode,We(e,t,r))})}clearWhere(){return new lt({...this.#t,onConflictNode:ht.cloneWithoutUpdateWhere(this.#t.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#t.onConflictNode}}Ae(lt,"don't await OnConflictUpdateBuilder instances.");const ft=p({is:e=>"TopNode"===e.kind,create:(e,t)=>p({kind:"TopNode",expression:e,modifiers:t})});function mt(t,o){if(!r(t)&&!s(t))throw new Error(`Invalid top expression: ${t}`);if(!e(o)&&!function(e){return"percent"===e||"with ties"===e||"percent with ties"===e}(o))throw new Error(`Invalid top modifiers: ${o}`);return ft.create(t,o)}class Nt{#t;constructor(e){this.#t=p(e)}values(e){const[t,r]=Ve(e);return new Nt({...this.#t,queryNode:Ke.cloneWith(this.#t.queryNode,{columns:t,values:r})})}columns(e){return new Nt({...this.#t,queryNode:Ke.cloneWith(this.#t.queryNode,{columns:p(e.map($.create))})})}expression(e){return new Nt({...this.#t,queryNode:Ke.cloneWith(this.#t.queryNode,{values:Dr(e)})})}defaultValues(){return new Nt({...this.#t,queryNode:Ke.cloneWith(this.#t.queryNode,{defaultValues:!0})})}ignore(){return new Nt({...this.#t,queryNode:Ke.cloneWith(this.#t.queryNode,{ignore:!0})})}top(e,t){return new Nt({...this.#t,queryNode:rt.cloneWithTop(this.#t.queryNode,mt(e,t))})}onConflict(e){return new Nt({...this.#t,queryNode:Ke.cloneWith(this.#t.queryNode,{onConflict:e(new ct({onConflictNode:ht.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new Nt({...this.#t,queryNode:Ke.cloneWith(this.#t.queryNode,{onDuplicateKey:st.create(it(e))})})}returning(e){return new Nt({...this.#t,queryNode:rt.cloneWithReturning(this.#t.queryNode,Je(e))})}returningAll(){return new Nt({...this.#t,queryNode:rt.cloneWithReturning(this.#t.queryNode,Pe())})}output(e){return new Nt({...this.#t,queryNode:rt.cloneWithOutput(this.#t.queryNode,Je(e))})}outputAll(e){return new Nt({...this.#t,queryNode:rt.cloneWithOutput(this.#t.queryNode,Pe(e))})}clearReturning(){return new Nt({...this.#t,queryNode:rt.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new Nt({...this.#t})}$castTo(){return new Nt(this.#t)}$narrowType(){return new Nt(this.#t)}$assertType(){return new Nt(this.#t)}withPlugin(e){return new Nt({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,o=e.query;return o.returning&&r.supportsReturning||o.output&&r.supportsOutput?t.rows:[new at(t.insertId,t.numAffectedRows??t.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=dt){const t=await this.executeTakeFirst();if(void 0===t){throw ut(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e,this.#t.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new Nt({...this.#t,queryNode:rt.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}Ae(Nt,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class yt{numDeletedRows;constructor(e){this.numDeletedRows=e}}const wt=p({is:e=>"LimitNode"===e.kind,create:e=>p({kind:"LimitNode",limit:e})});class gt{#t;constructor(e){this.#t=p(e)}where(...e){return new gt({...this.#t,queryNode:rt.cloneWithWhere(this.#t.queryNode,we(e))})}whereRef(e,t,r){return new gt({...this.#t,queryNode:rt.cloneWithWhere(this.#t.queryNode,We(e,t,r))})}clearWhere(){return new gt({...this.#t,queryNode:rt.cloneWithoutWhere(this.#t.queryNode)})}top(e,t){return new gt({...this.#t,queryNode:rt.cloneWithTop(this.#t.queryNode,mt(e,t))})}using(e){return new gt({...this.#t,queryNode:He.cloneWithUsing(this.#t.queryNode,Qr(e))})}innerJoin(...e){return new gt({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("InnerJoin",e))})}leftJoin(...e){return new gt({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("LeftJoin",e))})}rightJoin(...e){return new gt({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("RightJoin",e))})}fullJoin(...e){return new gt({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("FullJoin",e))})}returning(e){return new gt({...this.#t,queryNode:rt.cloneWithReturning(this.#t.queryNode,Je(e))})}returningAll(e){return new gt({...this.#t,queryNode:rt.cloneWithReturning(this.#t.queryNode,Pe(e))})}output(e){return new gt({...this.#t,queryNode:rt.cloneWithOutput(this.#t.queryNode,Je(e))})}outputAll(e){return new gt({...this.#t,queryNode:rt.cloneWithOutput(this.#t.queryNode,Pe(e))})}clearReturning(){return new gt({...this.#t,queryNode:rt.cloneWithoutReturning(this.#t.queryNode)})}clearLimit(){return new gt({...this.#t,queryNode:He.cloneWithoutLimit(this.#t.queryNode)})}clearOrderBy(){return new gt({...this.#t,queryNode:He.cloneWithoutOrderBy(this.#t.queryNode)})}orderBy(e,t){return new gt({...this.#t,queryNode:He.cloneWithOrderByItems(this.#t.queryNode,X([e,t]))})}limit(e){return new gt({...this.#t,queryNode:He.cloneWithLimit(this.#t.queryNode,wt.create(fe(e)))})}$call(e){return e(this)}$if(e,t){return e?t(this):new gt({...this.#t})}$castTo(){return new gt(this.#t)}$narrowType(){return new gt(this.#t)}$assertType(){return new gt(this.#t)}withPlugin(e){return new gt({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,o=e.query;return o.returning&&r.supportsReturning||o.output&&r.supportsOutput?t.rows:[new yt(t.numAffectedRows??t.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=dt){const t=await this.executeTakeFirst();if(void 0===t){throw ut(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e,this.#t.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new gt({...this.#t,queryNode:rt.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}Ae(gt,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Wt{numUpdatedRows;numChangedRows;constructor(e,t){this.numUpdatedRows=e,this.numChangedRows=t}}class qt{#t;constructor(e){this.#t=p(e)}where(...e){return new qt({...this.#t,queryNode:rt.cloneWithWhere(this.#t.queryNode,we(e))})}whereRef(e,t,r){return new qt({...this.#t,queryNode:rt.cloneWithWhere(this.#t.queryNode,We(e,t,r))})}clearWhere(){return new qt({...this.#t,queryNode:rt.cloneWithoutWhere(this.#t.queryNode)})}top(e,t){return new qt({...this.#t,queryNode:rt.cloneWithTop(this.#t.queryNode,mt(e,t))})}from(e){return new qt({...this.#t,queryNode:Ge.cloneWithFromItems(this.#t.queryNode,Qr(e))})}innerJoin(...e){return new qt({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("InnerJoin",e))})}leftJoin(...e){return new qt({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("LeftJoin",e))})}rightJoin(...e){return new qt({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("RightJoin",e))})}fullJoin(...e){return new qt({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("FullJoin",e))})}limit(e){return new qt({...this.#t,queryNode:Ge.cloneWithLimit(this.#t.queryNode,wt.create(fe(e)))})}set(...e){return new qt({...this.#t,queryNode:Ge.cloneWithUpdates(this.#t.queryNode,nt(...e))})}returning(e){return new qt({...this.#t,queryNode:rt.cloneWithReturning(this.#t.queryNode,Je(e))})}returningAll(){return new qt({...this.#t,queryNode:rt.cloneWithReturning(this.#t.queryNode,Pe())})}output(e){return new qt({...this.#t,queryNode:rt.cloneWithOutput(this.#t.queryNode,Je(e))})}outputAll(e){return new qt({...this.#t,queryNode:rt.cloneWithOutput(this.#t.queryNode,Pe(e))})}clearReturning(){return new qt({...this.#t,queryNode:rt.cloneWithoutReturning(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new qt({...this.#t})}$castTo(){return new qt(this.#t)}$narrowType(){return new qt(this.#t)}$assertType(){return new qt(this.#t)}withPlugin(e){return new qt({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId),{adapter:r}=this.#t.executor,o=e.query;return o.returning&&r.supportsReturning||o.output&&r.supportsOutput?t.rows:[new Wt(t.numAffectedRows??t.numUpdatedOrDeletedRows??BigInt(0),t.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=dt){const t=await this.executeTakeFirst();if(void 0===t){throw ut(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e,this.#t.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new qt({...this.#t,queryNode:rt.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}Ae(qt,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const Ot=p({is:e=>"CommonTableExpressionNameNode"===e.kind,create:(e,t)=>p({kind:"CommonTableExpressionNameNode",table:W.create(e),columns:t?p(t.map($.create)):void 0})}),bt=p({is:e=>"CommonTableExpressionNode"===e.kind,create:(e,t)=>p({kind:"CommonTableExpressionNode",name:e,expression:t}),cloneWith:(e,t)=>p({...e,...t})});class xt{#t;constructor(e){this.#t=p(e)}materialized(){return new xt({...this.#t,node:bt.cloneWith(this.#t.node,{materialized:!0})})}notMaterialized(){return new xt({...this.#t,node:bt.cloneWith(this.#t.node,{materialized:!1})})}toOperationNode(){return this.#t.node}}function kt(e,t){const r=t(new Xt({executor:Vt})).toOperationNode();return d(e)?e(function(e){return t=>new xt({node:bt.create(Ct(t),e)})}(r)).toOperationNode():bt.create(Ct(e),r)}function Ct(e){if(e.includes("(")){const t=e.split(/[\(\)]/),r=t[0],o=t[1].split(",").map((e=>e.trim()));return Ot.create(r,o)}return Ot.create(e)}Ae(xt,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");const It=p({is:e=>"WithNode"===e.kind,create:(e,t)=>p({kind:"WithNode",expressions:p([e]),...t}),cloneWithExpression:(e,t)=>p({...e,expressions:p([...e.expressions,t])})}),vt=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function Tt(e){let t="";for(let r=0;r<e;++r)t+=vt[~~(Math.random()*vt.length)];return t}function St(){return new Bt}class Bt{#r;get queryId(){return void 0===this.#r&&(this.#r=Tt(8)),this.#r}}class Rt{nodeStack=[];#o=p({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this)});transformNode(e){if(!e)return e;this.nodeStack.push(e);const t=this.transformNodeImpl(e);return this.nodeStack.pop(),p(t)}transformNodeImpl(e){return this.#o[e.kind](e)}transformNodeList(e){return e?p(e.map((e=>this.transformNode(e)))):e}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations),fetch:this.transformNode(e.fetch),top:this.transformNode(e.top)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:p([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues,top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain),limit:this.transformNode(e.limit),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformMergeQuery(e){return{kind:"MergeQueryNode",into:this.transformNode(e.into),using:this.transformNode(e.using),whens:this.transformNodeList(e.whens),with:this.transformNode(e.with),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformMatched(e){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformCast(e){return{kind:"CastNode",expression:this.transformNode(e.expression),dataType:this.transformNode(e.dataType)}}transformFetch(e){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount),modifier:e.modifier}}transformTop(e){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e){return{kind:"OutputNode",selections:this.transformNodeList(e.selections)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}const At=p({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0});class Lt extends Rt{#n;#i=new Set;#s=new Set;constructor(e){super(),this.#n=e}transformNodeImpl(e){if(!this.#a(e))return super.transformNodeImpl(e);const t=this.#d(e);for(const e of t)this.#s.add(e);const r=this.#u(e);for(const e of r)this.#i.add(e);const o=super.transformNodeImpl(e);for(const e of r)this.#i.delete(e);for(const e of t)this.#s.delete(e);return o}transformSchemableIdentifier(e){const t=super.transformSchemableIdentifier(e);return t.schema||!this.#i.has(e.identifier.name)?t:{...t,schema:y.create(this.#n)}}transformReferences(e){const t=super.transformReferences(e);return t.table.table.schema?t:{...t,table:W.createWithSchema(this.#n,t.table.table.identifier.name)}}#a(e){return e.kind in At}#u(e){const t=new Set;if("name"in e&&e.name&&w.is(e.name)&&this.#h(e.name,t),"from"in e&&e.from)for(const r of e.from.froms)this.#c(r,t);if("into"in e&&e.into&&this.#c(e.into,t),"table"in e&&e.table&&this.#c(e.table,t),"joins"in e&&e.joins)for(const r of e.joins)this.#c(r.table,t);return"using"in e&&e.using&&this.#c(e.using,t),t}#d(e){const t=new Set;return"with"in e&&e.with&&this.#p(e.with,t),t}#c(e,t){const r=W.is(e)?e:g.is(e)&&W.is(e.node)?e.node:null;r&&this.#h(r.table,t)}#h(e,t){const r=e.identifier.name;this.#i.has(r)||this.#s.has(r)||t.add(r)}#p(e,t){for(const r of e.expressions){const e=r.name.table.table.identifier.name;this.#s.has(e)||t.add(e)}}}class Et{#l;constructor(e){this.#l=new Lt(e)}transformQuery(e){return this.#l.transformNode(e.node)}async transformResult(e){return e.result}}const Ft=p({is:e=>"MatchedNode"===e.kind,create:(e,t=!1)=>p({kind:"MatchedNode",not:e,bySource:t})});function Dt(e,t,r){return Ze.create(Oe([Ft.create(!e.isMatched,e.bySource),...t&&t.length>0?[3===t.length&&r?We(t[0],t[1],t[2]):we(t)]:[]],"and",!1))}function Mt(e){return t(e)?H.create([e],[]):q(e)?e.toOperationNode():e}class Jt{#f;#m;#N;constructor(){this.#f=new Promise(((e,t)=>{this.#N=t,this.#m=e}))}get promise(){return this.#f}resolve=e=>{this.#m&&this.#m(e)};reject=e=>{this.#N&&this.#N(e)}}const Qt=new Set;function Pt(e){Qt.has(e)||(Qt.add(e),console.log(e))}const Ut=p([]);class $t{#y;constructor(e=Ut){this.#y=e}get plugins(){return this.#y}transformQuery(e,t){for(const r of this.#y){const o=r.transformQuery({node:e,queryId:t});if(o.kind!==e.kind)throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${o.kind}`].join(" "));e=o}return e}async executeQuery(e,t){return await this.provideConnection((async r=>{const o=await r.executeQuery(e),n=await this.#w(o,t);return function(e,t){const{numAffectedRows:r}=e;if(void 0===r&&void 0===e.numUpdatedOrDeletedRows||void 0!==r&&void 0!==t.numAffectedRows)return;Pt("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}(o,n),n}))}async*stream(e,t,r){const o=new Jt,n=new Jt;this.provideConnection((async e=>(o.resolve(e),await n.promise))).catch((e=>o.reject(e)));const i=await o.promise;try{for await(const o of i.streamQuery(e,t))yield await this.#w(o,r)}finally{n.resolve()}}async#w(e,t){for(const r of this.#y)e=await r.transformResult({result:e,queryId:t});return e}}class jt extends $t{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new jt([...this.plugins,e])}withPlugins(e){return new jt([...this.plugins,...e])}withPluginAtFront(e){return new jt([e,...this.plugins])}withoutPlugins(){return new jt([])}}const Vt=new jt;class Kt{numChangedRows;constructor(e){this.numChangedRows=e}}class Gt{#t;constructor(e){this.#t=p(e)}top(e,t){return new Gt({...this.#t,queryNode:rt.cloneWithTop(this.#t.queryNode,mt(e,t))})}using(...e){return new zt({...this.#t,queryNode:et.cloneWithUsing(this.#t.queryNode,Yt("Using",e))})}output(e){return new Gt({...this.#t,queryNode:rt.cloneWithOutput(this.#t.queryNode,Je(e))})}outputAll(e){return new Gt({...this.#t,queryNode:rt.cloneWithOutput(this.#t.queryNode,Pe(e))})}}Ae(Gt,"don't await MergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");class zt{#t;constructor(e){this.#t=p(e)}top(e,t){return new zt({...this.#t,queryNode:rt.cloneWithTop(this.#t.queryNode,mt(e,t))})}whenMatched(){return this.#g([])}whenMatchedAnd(...e){return this.#g(e)}whenMatchedAndRef(e,t,r){return this.#g([e,t,r],!0)}#g(e,t){return new Ht({...this.#t,queryNode:et.cloneWithWhen(this.#t.queryNode,Dt({isMatched:!0},e,t))})}whenNotMatched(){return this.#W([])}whenNotMatchedAnd(...e){return this.#W(e)}whenNotMatchedAndRef(e,t,r){return this.#W([e,t,r],!0)}whenNotMatchedBySource(){return this.#W([],!1,!0)}whenNotMatchedBySourceAnd(...e){return this.#W(e,!1,!0)}whenNotMatchedBySourceAndRef(e,t,r){return this.#W([e,t,r],!0,!0)}output(e){return new zt({...this.#t,queryNode:rt.cloneWithOutput(this.#t.queryNode,Je(e))})}outputAll(e){return new zt({...this.#t,queryNode:rt.cloneWithOutput(this.#t.queryNode,Pe(e))})}#W(e,t=!1,r=!1){const o={...this.#t,queryNode:et.cloneWithWhen(this.#t.queryNode,Dt({isMatched:!1,bySource:r},e,t))};return new(r?Ht:_t)(o)}$call(e){return e(this)}$if(e,t){return e?t(this):new zt({...this.#t})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile(),t=await this.#t.executor.executeQuery(e,this.#t.queryId);return e.query.output&&this.#t.executor.adapter.supportsOutput?t.rows:[new Kt(t.numAffectedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=dt){const t=await this.executeTakeFirst();if(void 0===t){throw ut(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}}Ae(zt,"don't await WheneableMergeQueryBuilder instances directly. To execute the query you need to call `execute`.");class Ht{#t;constructor(e){this.#t=p(e)}thenDelete(){return new zt({...this.#t,queryNode:et.cloneWithThen(this.#t.queryNode,Mt("delete"))})}thenDoNothing(){return new zt({...this.#t,queryNode:et.cloneWithThen(this.#t.queryNode,Mt("do nothing"))})}thenUpdate(e){return new zt({...this.#t,queryNode:et.cloneWithThen(this.#t.queryNode,Mt(e(new qt({queryId:this.#t.queryId,executor:Vt,queryNode:Ge.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate((t=>t.set(...e)))}}Ae(Ht,"don't await MatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");class _t{#t;constructor(e){this.#t=p(e)}thenDoNothing(){return new zt({...this.#t,queryNode:et.cloneWithThen(this.#t.queryNode,Mt("do nothing"))})}thenInsertValues(e){const[t,r]=Ve(e);return new zt({...this.#t,queryNode:et.cloneWithThen(this.#t.queryNode,Mt(Ke.cloneWith(Ke.createWithoutInto(),{columns:t,values:r})))})}}Ae(_t,"don't await NotMatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");class Xt{#t;constructor(e){this.#t=p(e)}selectFrom(e){return cr({queryId:St(),executor:this.#t.executor,queryNode:Re.createFrom(Qr(e),this.#t.withNode)})}selectNoFrom(e){return cr({queryId:St(),executor:this.#t.executor,queryNode:Re.cloneWithSelections(Re.create(this.#t.withNode),Je(e))})}insertInto(e){return new Nt({queryId:St(),executor:this.#t.executor,queryNode:Ke.create($r(e),this.#t.withNode)})}replaceInto(e){return new Nt({queryId:St(),executor:this.#t.executor,queryNode:Ke.create($r(e),this.#t.withNode,!0)})}deleteFrom(e){return new gt({queryId:St(),executor:this.#t.executor,queryNode:He.create(Qr(e),this.#t.withNode)})}updateTable(e){return new qt({queryId:St(),executor:this.#t.executor,queryNode:Ge.create(Pr(e),this.#t.withNode)})}mergeInto(e){return new Gt({queryId:St(),executor:this.#t.executor,queryNode:et.create(Ur(e),this.#t.withNode)})}with(e,t){const r=kt(e,t);return new Xt({...this.#t,withNode:this.#t.withNode?It.cloneWithExpression(this.#t.withNode,r):It.create(r)})}withRecursive(e,t){const r=kt(e,t);return new Xt({...this.#t,withNode:this.#t.withNode?It.cloneWithExpression(this.#t.withNode,r):It.create(r,{recursive:!0})})}withPlugin(e){return new Xt({...this.#t,executor:this.#t.executor.withPlugin(e)})}withoutPlugins(){return new Xt({...this.#t,executor:this.#t.executor.withoutPlugins()})}withSchema(e){return new Xt({...this.#t,executor:this.#t.executor.withPluginAtFront(new Et(e))})}}function Yt(e,t){if(3===t.length)return function(e,t,r,o){return v.createWithOn(e,Pr(t),We(r,"=",o))}(e,t[0],t[1],t[2]);if(2===t.length)return function(e,t,r){return r(function(e,t){return new Le({joinNode:v.create(e,Pr(t))})}(e,t)).toOperationNode()}(e,t[0],t[1]);throw new Error("not implemented")}const Zt=p({is:e=>"OffsetNode"===e.kind,create:e=>p({kind:"OffsetNode",offset:e})}),er=p({is:e=>"GroupByItemNode"===e.kind,create:e=>p({kind:"GroupByItemNode",groupBy:e})});function tr(e){return ne(e=d(e)?e(Fr()):e).map(er.create)}const rr=p({is:e=>"SetOperationNode"===e.kind,create:(e,t,r)=>p({kind:"SetOperationNode",operator:e,expression:t,all:r})});function or(e,t,r){return d(t)&&(t=t(Er())),f(t)||(t=[t]),t.map((t=>rr.create(e,Dr(t),r)))}class nr{#q;constructor(e){this.#q=e}get expressionType(){}as(e){return new ir(this,e)}or(...e){return new sr(C.create(this.#q,we(e)))}and(...e){return new ar(k.create(this.#q,we(e)))}$castTo(){return new nr(this.#q)}$notNull(){return new nr(this.#q)}toOperationNode(){return this.#q}}class ir{#O;#b;constructor(e,t){this.#O=e,this.#b=t}get expression(){return this.#O}get alias(){return this.#b}toOperationNode(){return g.create(this.#O.toOperationNode(),q(this.#b)?this.#b.toOperationNode():y.create(this.#b))}}class sr{#q;constructor(e){this.#q=e}get expressionType(){}as(e){return new ir(this,e)}or(...e){return new sr(C.create(this.#q,we(e)))}$castTo(){return new sr(this.#q)}toOperationNode(){return ye.create(this.#q)}}class ar{#q;constructor(e){this.#q=e}get expressionType(){}as(e){return new ir(this,e)}and(...e){return new ar(k.create(this.#q,we(e)))}$castTo(){return new ar(this.#q)}toOperationNode(){return ye.create(this.#q)}}const dr={is:e=>"FetchNode"===e.kind,create:(e,t)=>({kind:"FetchNode",rowCount:pe.create(e),modifier:t})};function ur(e,t){if(!r(e)&&!s(e))throw new Error(`Invalid fetch row count: ${e}`);if("only"!==(o=t)&&"with ties"!==o)throw new Error(`Invalid fetch modifier: ${t}`);var o;return dr.create(e,t)}class hr{#t;constructor(e){this.#t=p(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new hr({...this.#t,queryNode:rt.cloneWithWhere(this.#t.queryNode,we(e))})}whereRef(e,t,r){return new hr({...this.#t,queryNode:rt.cloneWithWhere(this.#t.queryNode,We(e,t,r))})}having(...e){return new hr({...this.#t,queryNode:Re.cloneWithHaving(this.#t.queryNode,we(e))})}havingRef(e,t,r){return new hr({...this.#t,queryNode:Re.cloneWithHaving(this.#t.queryNode,We(e,t,r))})}select(e){return new hr({...this.#t,queryNode:Re.cloneWithSelections(this.#t.queryNode,Je(e))})}distinctOn(e){return new hr({...this.#t,queryNode:Re.cloneWithDistinctOn(this.#t.queryNode,ne(e))})}modifyFront(e){return new hr({...this.#t,queryNode:Re.cloneWithFrontModifier(this.#t.queryNode,x.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new hr({...this.#t,queryNode:Re.cloneWithEndModifier(this.#t.queryNode,x.createWithExpression(e.toOperationNode()))})}distinct(){return new hr({...this.#t,queryNode:Re.cloneWithFrontModifier(this.#t.queryNode,x.create("Distinct"))})}forUpdate(e){return new hr({...this.#t,queryNode:Re.cloneWithEndModifier(this.#t.queryNode,x.create("ForUpdate",e?l(e).map($r):void 0))})}forShare(e){return new hr({...this.#t,queryNode:Re.cloneWithEndModifier(this.#t.queryNode,x.create("ForShare",e?l(e).map($r):void 0))})}forKeyShare(e){return new hr({...this.#t,queryNode:Re.cloneWithEndModifier(this.#t.queryNode,x.create("ForKeyShare",e?l(e).map($r):void 0))})}forNoKeyUpdate(e){return new hr({...this.#t,queryNode:Re.cloneWithEndModifier(this.#t.queryNode,x.create("ForNoKeyUpdate",e?l(e).map($r):void 0))})}skipLocked(){return new hr({...this.#t,queryNode:Re.cloneWithEndModifier(this.#t.queryNode,x.create("SkipLocked"))})}noWait(){return new hr({...this.#t,queryNode:Re.cloneWithEndModifier(this.#t.queryNode,x.create("NoWait"))})}selectAll(e){return new hr({...this.#t,queryNode:Re.cloneWithSelections(this.#t.queryNode,Pe(e))})}innerJoin(...e){return new hr({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("InnerJoin",e))})}leftJoin(...e){return new hr({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("LeftJoin",e))})}rightJoin(...e){return new hr({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("RightJoin",e))})}fullJoin(...e){return new hr({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("FullJoin",e))})}innerJoinLateral(...e){return new hr({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("LateralInnerJoin",e))})}leftJoinLateral(...e){return new hr({...this.#t,queryNode:rt.cloneWithJoin(this.#t.queryNode,Yt("LateralLeftJoin",e))})}orderBy(...e){return new hr({...this.#t,queryNode:Re.cloneWithOrderByItems(this.#t.queryNode,X(e))})}groupBy(e){return new hr({...this.#t,queryNode:Re.cloneWithGroupByItems(this.#t.queryNode,tr(e))})}limit(e){return new hr({...this.#t,queryNode:Re.cloneWithLimit(this.#t.queryNode,wt.create(fe(e)))})}offset(e){return new hr({...this.#t,queryNode:Re.cloneWithOffset(this.#t.queryNode,Zt.create(fe(e)))})}fetch(e,t="only"){return new hr({...this.#t,queryNode:Re.cloneWithFetch(this.#t.queryNode,ur(e,t))})}top(e,t){return new hr({...this.#t,queryNode:rt.cloneWithTop(this.#t.queryNode,mt(e,t))})}union(e){return new hr({...this.#t,queryNode:Re.cloneWithSetOperations(this.#t.queryNode,or("union",e,!1))})}unionAll(e){return new hr({...this.#t,queryNode:Re.cloneWithSetOperations(this.#t.queryNode,or("union",e,!0))})}intersect(e){return new hr({...this.#t,queryNode:Re.cloneWithSetOperations(this.#t.queryNode,or("intersect",e,!1))})}intersectAll(e){return new hr({...this.#t,queryNode:Re.cloneWithSetOperations(this.#t.queryNode,or("intersect",e,!0))})}except(e){return new hr({...this.#t,queryNode:Re.cloneWithSetOperations(this.#t.queryNode,or("except",e,!1))})}exceptAll(e){return new hr({...this.#t,queryNode:Re.cloneWithSetOperations(this.#t.queryNode,or("except",e,!0))})}as(e){return new pr(this,e)}clearSelect(){return new hr({...this.#t,queryNode:Re.cloneWithoutSelections(this.#t.queryNode)})}clearWhere(){return new hr({...this.#t,queryNode:rt.cloneWithoutWhere(this.#t.queryNode)})}clearLimit(){return new hr({...this.#t,queryNode:Re.cloneWithoutLimit(this.#t.queryNode)})}clearOffset(){return new hr({...this.#t,queryNode:Re.cloneWithoutOffset(this.#t.queryNode)})}clearOrderBy(){return new hr({...this.#t,queryNode:Re.cloneWithoutOrderBy(this.#t.queryNode)})}clearGroupBy(){return new hr({...this.#t,queryNode:Re.cloneWithoutGroupBy(this.#t.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new hr({...this.#t})}$castTo(){return new hr(this.#t)}$narrowType(){return new hr(this.#t)}$assertType(){return new hr(this.#t)}$asTuple(){return new nr(this.toOperationNode())}withPlugin(e){return new hr({...this.#t,executor:this.#t.executor.withPlugin(e)})}toOperationNode(){return this.#t.executor.transformQuery(this.#t.queryNode,this.#t.queryId)}compile(){return this.#t.executor.compileQuery(this.toOperationNode(),this.#t.queryId)}async execute(){const e=this.compile();return(await this.#t.executor.executeQuery(e,this.#t.queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=dt){const t=await this.executeTakeFirst();if(void 0===t){throw ut(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#t.executor.stream(t,e,this.#t.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new hr({...this.#t,queryNode:rt.cloneWithExplain(this.#t.queryNode,e,t)});return await r.execute()}}function cr(e){return new hr(e)}Ae(hr,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class pr{#x;#b;constructor(e,t){this.#x=e,this.#b=t}get expression(){return this.#x}get alias(){return this.#b}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return g.create(this.#x.toOperationNode(),y.create(this.#b))}}Ae(pr,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const lr=p({is:e=>"AggregateFunctionNode"===e.kind,create:(e,t=[])=>p({kind:"AggregateFunctionNode",func:e,aggregated:t}),cloneWithDistinct:e=>p({...e,distinct:!0}),cloneWithFilter:(e,t)=>p({...e,filter:e.filter?_e.cloneWithOperation(e.filter,"And",t):_e.create(t)}),cloneWithOrFilter:(e,t)=>p({...e,filter:e.filter?_e.cloneWithOperation(e.filter,"Or",t):_e.create(t)}),cloneWithOver:(e,t)=>p({...e,over:t})}),fr=p({is:e=>"FunctionNode"===e.kind,create:(e,t)=>p({kind:"FunctionNode",func:e,arguments:t})});class mr{#t;constructor(e){this.#t=p(e)}get expressionType(){}as(e){return new Nr(this,e)}distinct(){return new mr({...this.#t,aggregateFunctionNode:lr.cloneWithDistinct(this.#t.aggregateFunctionNode)})}filterWhere(...e){return new mr({...this.#t,aggregateFunctionNode:lr.cloneWithFilter(this.#t.aggregateFunctionNode,we(e))})}filterWhereRef(e,t,r){return new mr({...this.#t,aggregateFunctionNode:lr.cloneWithFilter(this.#t.aggregateFunctionNode,We(e,t,r))})}over(e){const t=new De({overNode:ve.create()});return new mr({...this.#t,aggregateFunctionNode:lr.cloneWithOver(this.#t.aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}$castTo(){return new mr(this.#t)}$notNull(){return new mr(this.#t)}toOperationNode(){return this.#t.aggregateFunctionNode}}Ae(mr,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");class Nr{#k;#b;constructor(e,t){this.#k=e,this.#b=t}get expression(){return this.#k}get alias(){return this.#b}toOperationNode(){return g.create(this.#k.toOperationNode(),y.create(this.#b))}}function yr(){const e=(e,t)=>new nr(fr.create(e,ne(t??[]))),r=(e,t)=>new mr({aggregateFunctionNode:lr.create(e,t?ne(t):void 0)});return Object.assign(e,{agg:r,avg:e=>r("avg",[e]),coalesce:(...t)=>e("coalesce",t),count:e=>r("count",[e]),countAll:e=>new mr({aggregateFunctionNode:lr.create("count",Pe(e))}),max:e=>r("max",[e]),min:e=>r("min",[e]),sum:e=>r("sum",[e]),any:t=>e("any",[t]),jsonAgg:e=>new mr({aggregateFunctionNode:lr.create("json_agg",[t(e)?$r(e):e.toOperationNode()])}),toJson:e=>new nr(fr.create("to_json",[t(e)?$r(e):e.toOperationNode()]))})}const wr=p({is:e=>"UnaryOperationNode"===e.kind,create:(e,t)=>p({kind:"UnaryOperationNode",operator:e,operand:t})});const gr=p({is:e=>"CaseNode"===e.kind,create:e=>p({kind:"CaseNode",value:e}),cloneWithWhen:(e,t)=>p({...e,when:p(e.when?[...e.when,t]:[t])}),cloneWithThen:(e,t)=>p({...e,when:e.when?p([...e.when.slice(0,-1),Ze.cloneWithResult(e.when[e.when.length-1],t)]):void 0}),cloneWith:(e,t)=>p({...e,...t})});class Wr{#t;constructor(e){this.#t=p(e)}when(...e){return new qr({...this.#t,node:gr.cloneWithWhen(this.#t.node,Ze.create(we(e)))})}}class qr{#t;constructor(e){this.#t=p(e)}then(e){return new Or({...this.#t,node:gr.cloneWithThen(this.#t.node,me(e)?Ne(e):fe(e))})}}class Or{#t;constructor(e){this.#t=p(e)}when(...e){return new qr({...this.#t,node:gr.cloneWithWhen(this.#t.node,Ze.create(we(e)))})}else(e){return new br({...this.#t,node:gr.cloneWith(this.#t.node,{else:me(e)?Ne(e):fe(e)})})}end(){return new nr(gr.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new nr(gr.cloneWith(this.#t.node,{isStatement:!0}))}}class br{#t;constructor(e){this.#t=p(e)}end(){return new nr(gr.cloneWith(this.#t.node,{isStatement:!1}))}endCase(){return new nr(gr.cloneWith(this.#t.node,{isStatement:!0}))}}const xr=p({is:e=>"JSONPathLegNode"===e.kind,create:(e,t)=>p({kind:"JSONPathLegNode",type:e,value:t})});class kr{#q;constructor(e){this.#q=e}at(e){return this.#C("ArrayLocation",e)}key(e){return this.#C("Member",e)}#C(e,t){return ee.is(this.#q)?new Cr(ee.cloneWithTraversal(this.#q,re.is(this.#q.traversal)?re.cloneWithLeg(this.#q.traversal,xr.create(e,t)):te.cloneWithValue(this.#q.traversal,pe.createImmediate(t)))):new Cr(re.cloneWithLeg(this.#q,xr.create(e,t)))}}class Cr extends kr{#q;constructor(e){super(e),this.#q=e}get expressionType(){}as(e){return new Ir(this,e)}$castTo(){return new kr(this.#q)}$notNull(){return new kr(this.#q)}toOperationNode(){return this.#q}}class Ir{#I;#b;constructor(e,t){this.#I=e,this.#b=t}get expression(){return this.#I}get alias(){return this.#b}toOperationNode(){return g.create(this.#I.toOperationNode(),q(this.#b)?this.#b.toOperationNode():y.create(this.#b))}}const vr=p({is:e=>"TupleNode"===e.kind,create:e=>p({kind:"TupleNode",values:p(e)})}),Tr=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob"],Sr=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/],Br=p({is:e=>"DataTypeNode"===e.kind,create:e=>p({kind:"DataTypeNode",dataType:e})});function Rr(e){return!!Tr.includes(e)||!!Sr.some((t=>t.test(e)))}function Ar(e){if(q(e))return e.toOperationNode();if(Rr(e))return Br.create(e);throw new Error(`invalid column data type ${JSON.stringify(e)}`)}const Lr=p({is:e=>"CastNode"===e.kind,create:(e,t)=>p({kind:"CastNode",expression:e,dataType:t})});function Er(t=Vt){function r(e,t){return new nr((r=e,o=t,wr.create(D.create(r),ie(o))));var r,o}const o=Object.assign((function(e,t,r){return new nr(ge(e,t,r))}),{fn:void 0,eb:void 0,selectFrom:e=>cr({queryId:St(),executor:t,queryNode:Re.createFrom(Qr(e))}),case:t=>new Wr({node:gr.create(e(t)?void 0:ie(t))}),ref:(t,r)=>e(r)?new nr(se(t)):new kr(function(e,t){const r=se(e);if(U(t))return ee.create(r,te.create(D.create(t)));const o=t.slice(0,-1);if(U(o))return ee.create(r,re.create(D.create(o)));throw new Error(`Invalid JSON operator: ${t}`)}(t,r)),jsonPath:()=>new kr(re.create()),table:e=>new nr($r(e)),val:e=>new nr(fe(e)),refTuple:(...e)=>new nr(vr.create(e.map(ie))),tuple:(...e)=>new nr(vr.create(e.map(fe))),lit:e=>new nr(Ne(e)),unary:r,not:e=>r("not",e),exists:e=>r("exists",e),neg:e=>r("-",e),between:(e,t,r)=>new nr(T.create(ie(e),D.create("between"),k.create(fe(t),fe(r)))),betweenSymmetric:(e,t,r)=>new nr(T.create(ie(e),D.create("between symmetric"),k.create(fe(t),fe(r)))),and:e=>f(e)?new nr(Oe(e,"and")):new nr(qe(e,"and")),or:e=>f(e)?new nr(Oe(e,"or")):new nr(qe(e,"or")),parens(...e){const t=we(e);return ye.is(t)?new nr(t):new nr(ye.create(t))},cast:(e,t)=>new nr(Lr.create(ie(e),Ar(t))),withSchema:e=>Er(t.withPluginAtFront(new Et(e)))});return o.fn=yr(),o.eb=o,o}function Fr(e){return Er()}function Dr(e){if(q(e))return e.toOperationNode();if(d(e))return e(Fr()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(e)}`)}function Mr(e){if(q(e))return e.toOperationNode();if(d(e))return e(Fr()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(e)}`)}function Jr(e){return O(e)||b(e)||d(e)}function Qr(e){return f(e)?e.map((e=>Pr(e))):[Pr(e)]}function Pr(e){return t(e)?Ur(e):Mr(e)}function Ur(e){const t=" as ";if(e.includes(t)){const[r,o]=e.split(t).map(jr);return g.create($r(r),y.create(o))}return $r(e)}function $r(e){if(e.includes(".")){const[t,r]=e.split(".").map(jr);return W.createWithSchema(t,r)}return W.create(e)}function jr(e){return e.trim()}class Vr{#t;constructor(e){this.#t=p(e)}get expressionType(){}get isRawBuilder(){return!0}as(e){return new Gr(this,e)}$castTo(){return new Vr({...this.#t})}$notNull(){return new Vr(this.#t)}withPlugin(e){return new Vr({...this.#t,plugins:void 0!==this.#t.plugins?p([...this.#t.plugins,e]):p([e])})}toOperationNode(){return this.#v(this.#T())}compile(e){return this.#S(this.#T(e))}async execute(e){const t=this.#T(e);return t.executeQuery(this.#S(t),this.#t.queryId)}#T(e){const t=void 0!==e?e.getExecutor():Vt;return void 0!==this.#t.plugins?t.withPlugins(this.#t.plugins):t}#v(e){return e.transformQuery(this.#t.rawNode,this.#t.queryId)}#S(e){return e.compileQuery(this.#v(e),this.#t.queryId)}}function Kr(e){return new Vr(e)}Ae(Vr,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");class Gr{#B;#b;constructor(e,t){this.#B=e,this.#b=t}get expression(){return this.#B}get alias(){return this.#b}get rawBuilder(){return this.#B}toOperationNode(){return g.create(this.#B.toOperationNode(),q(this.#b)?this.#b.toOperationNode():y.create(this.#b))}}Ae(Gr,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const zr=Object.assign(((e,...t)=>Kr({queryId:St(),rawNode:H.create(e,t?.map(Hr)??[])})),{ref:e=>Kr({queryId:St(),rawNode:H.createWithChild(se(e))}),val:e=>Kr({queryId:St(),rawNode:H.createWithChild(fe(e))}),value(e){return this.val(e)},table:e=>Kr({queryId:St(),rawNode:H.createWithChild($r(e))}),id(...e){const t=new Array(e.length+1).fill(".");return t[0]="",t[t.length-1]="",Kr({queryId:St(),rawNode:H.create(t,e.map(y.create))})},lit:e=>Kr({queryId:St(),rawNode:H.createWithChild(pe.createImmediate(e))}),literal(e){return this.lit(e)},raw:e=>Kr({queryId:St(),rawNode:H.createWithSql(e)}),join(e,t=zr`, `){const r=new Array(2*e.length-1),o=t.toOperationNode();for(let t=0;t<e.length;++t)r[2*t]=Hr(e[t]),t!==e.length-1&&(r[2*t+1]=o);return Kr({queryId:St(),rawNode:H.createWithChildren(r)})}});function Hr(e){return q(e)?e.toOperationNode():fe(e)}export{b as $,D as A,r as B,$ as C,K as D,n as E,i as F,s as G,Re as H,y as I,c as J,zr as K,Tt as L,et as M,Jt as N,Rt as O,ye as P,rt as Q,H as R,w as S,a as T,h as U,pe as V,Et as W,N as X,Fr as Y,Pt as Z,O as _,se as a,C as a$,nr as a0,ir as a1,sr as a2,ar as a3,cr as a4,Nt as a5,qt as a6,gt as a7,dt as a8,ut as a9,bt as aA,Ot as aB,Br as aC,Rr as aD,He as aE,Te as aF,er as aG,Se as aH,Be as aI,v as aJ,wt as aK,Zt as aL,ht as aM,st as aN,I as aO,S as aP,B as aQ,R as aR,A as aS,L as aT,E as aU,F as aV,M as aW,J as aX,Q as aY,P as aZ,U as a_,Le as aa,at as ab,yt as ac,Wt as ad,ct as ae,pt as af,lt as ag,mr as ah,Nr as ai,qr as aj,Or as ak,br as al,kr as am,Cr as an,Ir as ao,Gt as ap,zt as aq,Ht as ar,_t as as,Kt as at,Kr as au,jt as av,Vt as aw,g as ax,k as ay,ot as az,j as b,z as b0,Ce as b1,he as b2,V as b3,Xe as b4,Me as b5,W as b6,Ge as b7,$e as b8,Ze as b9,_e as ba,It as bb,Ye as bc,je as bd,lr as be,ve as bf,Ie as bg,Ee as bh,T as bi,wr as bj,ze as bk,ee as bl,xr as bm,re as bn,te as bo,vr as bp,Ft as bq,dr as br,ft as bs,tt as bt,Ar as c,de as d,$r as e,p as f,we as g,Dr as h,q as i,ae as j,ce as k,St as l,$t as m,m as n,d as o,Ae as p,u as q,Xt as r,Wr as s,gr as t,e as u,yr as v,Ke as w,rr as x,t as y,o as z};
