import{J as o,R as n,C as e,al as t,I as s}from"../sql-iOz-TslO.js";function jsonArrayFrom(n){return o`(select cast(coalesce(json_arrayagg(json_object(${o.join(getJsonObjectArgs(n.toOperationNode(),"agg"))})), '[]') as json) from ${n} as agg)`}function jsonObjectFrom(n){return o`(select json_object(${o.join(getJsonObjectArgs(n.toOperationNode(),"obj"))}) from ${n} as obj)`}function jsonBuildObject(n){return o`json_object(${o.join(Object.keys(n).flatMap((e=>[o.lit(e),n[e]])))})`}function getJsonObjectArgs(r,a){return r.selections.flatMap((({selection:r})=>{if(n.is(r)&&e.is(r.column))return[o.lit(r.column.column.name),o.id(a,r.column.column.name)];if(e.is(r))return[o.lit(r.column.name),o.id(a,r.column.name)];if(t.is(r)&&s.is(r.alias))return[o.lit(r.alias.name),o.id(a,r.alias.name)];throw new Error("MySQL jsonArrayFrom and jsonObjectFrom functions can only handle explicit selections due to limitations of the json_object function. selectAll() is not allowed in the subquery.")}))}export{jsonArrayFrom,jsonBuildObject,jsonObjectFrom};
