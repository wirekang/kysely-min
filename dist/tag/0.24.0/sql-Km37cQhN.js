function e(e){return void 0===e||void 0===e}function t(e){return"string"==typeof e}function r(e){return"number"==typeof e}function o(e){return"boolean"==typeof e}function n(e){return null===e}function i(e){return e instanceof Date}function s(e){return"bigint"==typeof e}function a(e){return"undefined"!=typeof Buffer&&Buffer.isBuffer(e)}function d(e){return"function"==typeof e}function u(e){return"object"==typeof e&&null!==e}function h(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}function c(e){return e[e.length-1]}function p(e){return Object.freeze(e)}function l(e){return Array.isArray(e)}function f(e){return e}function N(e,t){return l(e)&&l(t)?function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!N(e[r],t[r]))return!1;return!0}(e,t):u(e)&&u(t)?function(e,t){if(a(e)&&a(t))return o=e,n=t,0===Buffer.compare(o,n);if(i(e)&&i(t))return r=t,e.getTime()===r.getTime();var r;var o,n;return function(e,t){const r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(const o of r)if(!N(e[o],t[o]))return!1;return!0}(e,t)}(e,t):e===t}const m=p({is:e=>"IdentifierNode"===e.kind,create:e=>p({kind:"IdentifierNode",name:e})}),y=p({is:e=>"SchemableIdentifierNode"===e.kind,create:e=>p({kind:"SchemableIdentifierNode",identifier:m.create(e)}),createWithSchema:(e,t)=>p({kind:"SchemableIdentifierNode",schema:m.create(e),identifier:m.create(t)})}),w=p({is:e=>"TableNode"===e.kind,create:e=>p({kind:"TableNode",table:y.create(e)}),createWithSchema:(e,t)=>p({kind:"TableNode",table:y.createWithSchema(e,t)})}),g=p({is:e=>"AliasNode"===e.kind,create:(e,t)=>p({kind:"AliasNode",node:e,alias:t})});function W(e){return u(e)&&d(e.toOperationNode)}function O(e){return u(e)&&"expressionType"in e&&W(e)}function x(e){return u(e)&&"expression"in e&&t(e.alias)&&W(e)}const q=p({is:e=>"SelectModifierNode"===e.kind,create:e=>p({kind:"SelectModifierNode",modifier:e}),createWithExpression:e=>p({kind:"SelectModifierNode",rawModifier:e})}),b=p({is:e=>"AndNode"===e.kind,create:(e,t)=>p({kind:"AndNode",left:e,right:t})}),k=p({is:e=>"OrNode"===e.kind,create:(e,t)=>p({kind:"OrNode",left:e,right:t})}),C=p({is:e=>"OnNode"===e.kind,create:e=>p({kind:"OnNode",on:e}),cloneWithOperation:(e,t,r)=>p({...e,on:"And"===t?b.create(e.on,r):k.create(e.on,r)})}),I=p({is:e=>"JoinNode"===e.kind,create:(e,t)=>p({kind:"JoinNode",joinType:e,table:t,on:void 0}),createWithOn:(e,t,r)=>p({kind:"JoinNode",joinType:e,table:t,on:C.create(r)}),cloneWithOn:(e,t)=>p({...e,on:e.on?C.cloneWithOperation(e.on,"And",t):C.create(t)}),cloneWithOrOn:(e,t)=>p({...e,on:e.on?C.cloneWithOperation(e.on,"Or",t):C.create(t)})}),v=p({is:e=>"BinaryOperationNode"===e.kind,create:(e,t,r)=>p({kind:"BinaryOperationNode",leftOperand:e,operator:t,rightOperand:r})}),T=p({is:e=>"RawNode"===e.kind,create:(e,t)=>p({kind:"RawNode",sqlFragments:p(e),parameters:p(t)}),createWithSql:e=>T.create([e],[]),createWithChild:e=>T.create(["",""],[e]),createWithChildren:e=>T.create(new Array(e.length+1).fill(""),e)}),E=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->"],B=["+","-","*","/","%","^","&","|","#","<<",">>"],S=[...E,...B,"&&","||"],F=["exists","not exists"],R=["not","-",...F],D=[...S,...R],A=p({is:e=>"OperatorNode"===e.kind,create:e=>p({kind:"OperatorNode",operator:e})});function L(e){return t(e)&&D.includes(e)}function U(e){return t(e)&&S.includes(e)}function j(e){return t(e)&&E.includes(e)}function J(e){return t(e)&&B.includes(e)}const P=p({is:e=>"ParensNode"===e.kind,create:e=>p({kind:"ParensNode",node:e})}),Q=p({is:e=>"ColumnNode"===e.kind,create:e=>p({kind:"ColumnNode",column:m.create(e)})}),$=p({is:e=>"SelectAllNode"===e.kind,create:()=>p({kind:"SelectAllNode"})}),M=p({is:e=>"ReferenceNode"===e.kind,create:(e,t)=>p({kind:"ReferenceNode",table:e,column:t}),createSelectAll:e=>p({kind:"ReferenceNode",table:e,column:$.create()})});function V(e){return t(e)?G(e):e.toOperationNode()}function K(e){return l(e)?e.map((e=>H(e))):[H(e)]}function H(e){return Gt(e)?Kt(e):V(e)}function G(e){if(e.includes(".")){const t=e.split(".").map(X);if(3===t.length)return function(e){const[t,r,o]=e;return M.create(w.createWithSchema(t,r),Q.create(o))}(t);if(2===t.length)return function(e){const[t,r]=e;return M.create(w.create(t),Q.create(r))}(t);throw new Error(`invalid column reference ${e}`)}return Q.create(e)}function z(e){return Q.create(e)}function X(e){return e.trim()}const Y=p({is:e=>"PrimitiveValueListNode"===e.kind,create:e=>p({kind:"PrimitiveValueListNode",values:p([...e])})}),Z=p({is:e=>"ValueListNode"===e.kind,create:e=>p({kind:"ValueListNode",values:p(e)})}),_=p({is:e=>"ValueNode"===e.kind,create:e=>p({kind:"ValueNode",value:e}),createImmediate:e=>p({kind:"ValueNode",value:e,immediate:!0})});function ee(e){return l(e)?function(e){if(e.some(Gt))return Z.create(e.map((e=>te(e))));return Y.create(e)}(e):te(e)}function te(e){return Gt(e)?Kt(e):_.create(e)}const re=p({is:e=>"OrderByNode"===e.kind,create:e=>p({kind:"OrderByNode",items:p([e])}),cloneWithItem:(e,t)=>p({...e,items:p([...e.items,t])})}),oe=p({is:e=>"PartitionByNode"===e.kind,create:e=>p({kind:"PartitionByNode",items:p(e)}),cloneWithItems:(e,t)=>p({...e,items:p([...e.items,...t])})}),ne=p({is:e=>"OverNode"===e.kind,create:()=>p({kind:"OverNode"}),cloneWithOrderByItem:(e,t)=>p({...e,orderBy:e.orderBy?re.cloneWithItem(e.orderBy,t):re.create(t)}),cloneWithPartitionByItems:(e,t)=>p({...e,partitionBy:e.partitionBy?oe.cloneWithItems(e.partitionBy,t):oe.create(t)})}),ie=p({is:e=>"FromNode"===e.kind,create:e=>p({kind:"FromNode",froms:p(e)}),cloneWithFroms:(e,t)=>p({...e,froms:p([...e.froms,...t])})}),se=p({is:e=>"GroupByNode"===e.kind,create:e=>p({kind:"GroupByNode",items:p(e)}),cloneWithItems:(e,t)=>p({...e,items:p([...e.items,...t])})}),ae=p({is:e=>"HavingNode"===e.kind,create:e=>p({kind:"HavingNode",having:e}),cloneWithOperation:(e,t,r)=>p({...e,having:"And"===t?b.create(e.having,r):k.create(e.having,r)})}),de=p({is:e=>"SelectQueryNode"===e.kind,create:(e,t)=>p({kind:"SelectQueryNode",from:ie.create(e),...t&&{with:t}}),cloneWithSelections:(e,t)=>p({...e,selections:e.selections?p([...e.selections,...t]):p(t)}),cloneWithDistinctOn:(e,t)=>p({...e,distinctOn:e.distinctOn?p([...e.distinctOn,...t]):p(t)}),cloneWithFrontModifier:(e,t)=>p({...e,frontModifiers:e.frontModifiers?p([...e.frontModifiers,t]):p([t])}),cloneWithEndModifier:(e,t)=>p({...e,endModifiers:e.endModifiers?p([...e.endModifiers,t]):p([t])}),cloneWithOrderByItem:(e,t)=>p({...e,orderBy:e.orderBy?re.cloneWithItem(e.orderBy,t):re.create(t)}),cloneWithGroupByItems:(e,t)=>p({...e,groupBy:e.groupBy?se.cloneWithItems(e.groupBy,t):se.create(t)}),cloneWithLimit:(e,t)=>p({...e,limit:t}),cloneWithOffset:(e,t)=>p({...e,offset:t}),cloneWithHaving:(e,t)=>p({...e,having:e.having?ae.cloneWithOperation(e.having,"And",t):ae.create(t)}),cloneWithOrHaving:(e,t)=>p({...e,having:e.having?ae.cloneWithOperation(e.having,"Or",t):ae.create(t)}),cloneWithSetOperation:(e,t)=>p({...e,setOperations:e.setOperations?p([...e.setOperations,t]):p([t])}),cloneWithoutSelections:e=>p({...e,selections:[]}),cloneWithoutLimit:e=>p({...e,limit:void 0}),cloneWithoutOffset:e=>p({...e,offset:void 0}),cloneWithoutOrderBy:e=>p({...e,orderBy:void 0})}),ue=p({is:e=>"UnaryOperationNode"===e.kind,create:(e,t)=>p({kind:"UnaryOperationNode",operator:e,operand:t})});function he(e){return pe("exists",e)}function ce(e){return pe("not exists",e)}function pe(e,t){return ue.create(A.create(e),H(t))}function le(e,t){Object.defineProperties(e.prototype,{then:{enumerable:!1,value:()=>{throw new Error(t)}}})}class fe{#e;constructor(e){this.#e=p(e)}on(...e){return new fe({...this.#e,joinNode:I.cloneWithOn(this.#e.joinNode,bt(e))})}orOn(...e){return new fe({...this.#e,joinNode:I.cloneWithOrOn(this.#e.joinNode,bt(e))})}onRef(e,t,r){return new fe({...this.#e,joinNode:I.cloneWithOn(this.#e.joinNode,Ot(e,t,r))})}orOnRef(e,t,r){return new fe({...this.#e,joinNode:I.cloneWithOrOn(this.#e.joinNode,Ot(e,t,r))})}onExists(e){return new fe({...this.#e,joinNode:I.cloneWithOn(this.#e.joinNode,he(e))})}onNotExists(e){return new fe({...this.#e,joinNode:I.cloneWithOn(this.#e.joinNode,ce(e))})}orOnExists(e){return new fe({...this.#e,joinNode:I.cloneWithOrOn(this.#e.joinNode,he(e))})}orOnNotExists(e){return new fe({...this.#e,joinNode:I.cloneWithOrOn(this.#e.joinNode,ce(e))})}onTrue(){return new fe({...this.#e,joinNode:I.cloneWithOn(this.#e.joinNode,T.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#e.joinNode}}le(fe,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const Ne=p({is:e=>"OrderByItemNode"===e.kind,create:(e,t)=>p({kind:"OrderByItemNode",orderBy:e,direction:t})});function me(e,t){return Ne.create(H(e),function(e){if(!e)return;return"asc"===e||"desc"===e?T.createWithSql(e):e.toOperationNode()}(t))}const ye=p({is:e=>"PartitionByItemNode"===e.kind,create:e=>p({kind:"PartitionByItemNode",partitionBy:e})});function we(e){return K(e).map(ye.create)}class ge{#e;constructor(e){this.#e=p(e)}orderBy(e,t){return new ge({overNode:ne.cloneWithOrderByItem(this.#e.overNode,me(e,t))})}partitionBy(e){return new ge({overNode:ne.cloneWithPartitionByItems(this.#e.overNode,we(e))})}$call(e){return e(this)}toOperationNode(){return this.#e.overNode}}le(ge,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const We=p({is:e=>"SelectionNode"===e.kind,create:e=>p({kind:"SelectionNode",selection:e}),createSelectAll:()=>p({kind:"SelectionNode",selection:$.create()}),createSelectAllFromTable:e=>p({kind:"SelectionNode",selection:M.createSelectAll(e)})});class Oe{#t;get dynamicReference(){return this.#t}get refType(){}constructor(e){this.#t=e}toOperationNode(){return V(this.#t)}}function xe(e){return d(e)?xe(e(Vt())):l(e)?e.map((e=>qe(e))):[qe(e)]}function qe(e){return t(e)?We.create(function(e){const t=" as ";if(e.includes(t)){const[r,o]=e.split(t).map(X);return g.create(G(r),m.create(o))}return G(e)}(e)):u(r=e)&&W(r)&&t(r.dynamicReference)?We.create(e.toOperationNode()):We.create(Ht(e));var r}function be(e){return e?Array.isArray(e)?e.map(ke):[ke(e)]:[We.createSelectAll()]}function ke(e){if(t(e))return We.createSelectAllFromTable(Yt(e));throw new Error(`invalid value selectAll expression: ${JSON.stringify(e)}`)}const Ce=p({is:e=>"ValuesNode"===e.kind,create:e=>p({kind:"ValuesNode",values:p(e)})}),Ie=p({is:e=>"DefaultInsertValueNode"===e.kind,create:()=>p({kind:"DefaultInsertValueNode"})});function ve(t){const r=d(t)?t(Vt()):t;return function(t){const r=function(e){const t=new Map;for(const r of e){const e=Object.keys(r);for(const o of e)t.has(o)||void 0===r[o]||t.set(o,t.size)}return t}(t);return[p([...r.keys()].map(Q.create)),Ce.create(t.map((t=>function(t,r){const o=Object.keys(t),n=Array.from({length:r.size});let i=!1;for(const s of o){const o=r.get(s);if(e(o))continue;const a=t[s];(e(a)||Gt(a))&&(i=!0),n[o]=a}const s=o.length<r.size;if(s||i){const t=Ie.create();return Z.create(n.map((r=>e(r)?t:te(r))))}return Y.create(n)}(t,r))))]}(l(r)?r:p([r]))}const Te=p({is:e=>"InsertQueryNode"===e.kind,create:(e,t,r)=>p({kind:"InsertQueryNode",into:e,...t&&{with:t},replace:r}),cloneWith:(e,t)=>p({...e,...t})}),Ee=p({is:e=>"UpdateQueryNode"===e.kind,create:(e,t)=>p({kind:"UpdateQueryNode",table:e,...t&&{with:t}}),cloneWithFromItems:(e,t)=>p({...e,from:e.from?ie.cloneWithFroms(e.from,t):ie.create(t)}),cloneWithUpdates:(e,t)=>p({...e,updates:e.updates?p([...e.updates,...t]):t})}),Be=p({is:e=>"UsingNode"===e.kind,create:e=>p({kind:"UsingNode",tables:p(e)}),cloneWithTables:(e,t)=>p({...e,tables:p([...e.tables,...t])})}),Se=p({is:e=>"DeleteQueryNode"===e.kind,create:(e,t)=>p({kind:"DeleteQueryNode",from:ie.create(e),...t&&{with:t}}),cloneWithOrderByItem:(e,t)=>p({...e,orderBy:e.orderBy?re.cloneWithItem(e.orderBy,t):re.create(t)}),cloneWithLimit:(e,t)=>p({...e,limit:t}),cloneWithUsing:(e,t)=>p({...e,using:void 0!==e.using?Be.cloneWithTables(e.using,t):Be.create(t)})}),Fe=p({is:e=>"WhereNode"===e.kind,create:e=>p({kind:"WhereNode",where:e}),cloneWithOperation:(e,t,r)=>p({...e,where:"And"===t?b.create(e.where,r):k.create(e.where,r)})}),Re=p({is:e=>"ReturningNode"===e.kind,create:e=>p({kind:"ReturningNode",selections:p(e)}),cloneWithSelections:(e,t)=>p({...e,selections:e.selections?p([...e.selections,...t]):p(t)})}),De=p({is:e=>"ExplainNode"===e.kind,create:(e,t)=>p({kind:"ExplainNode",format:e,options:t})}),Ae=p({is:e=>de.is(e)||Te.is(e)||Ee.is(e)||Se.is(e),cloneWithWhere:(e,t)=>p({...e,where:e.where?Fe.cloneWithOperation(e.where,"And",t):Fe.create(t)}),cloneWithOrWhere:(e,t)=>p({...e,where:e.where?Fe.cloneWithOperation(e.where,"Or",t):Fe.create(t)}),cloneWithJoin:(e,t)=>p({...e,joins:e.joins?p([...e.joins,t]):p([t])}),cloneWithReturning:(e,t)=>p({...e,returning:e.returning?Re.cloneWithSelections(e.returning,t):Re.create(t)}),cloneWithoutWhere:e=>p({...e,where:void 0}),cloneWithExplain:(e,t,r)=>p({...e,explain:De.create(t,r?.toOperationNode())})}),Le=p({is:e=>"ColumnUpdateNode"===e.kind,create:(e,t)=>p({kind:"ColumnUpdateNode",column:e,value:t})});function Ue(e){const t=d(e)?e(Vt()):e;return Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>Le.create(Q.create(e),te(t))))}const je=p({is:e=>"OnDuplicateKeyNode"===e.kind,create:e=>p({kind:"OnDuplicateKeyNode",updates:e})});class Je{#r;#o;constructor(e,t){this.#r=e,this.#o=t}get insertId(){return this.#r}get numInsertedOrUpdatedRows(){return this.#o}}for(const e of["insertId","numInsertedOrUpdatedRows"])Object.defineProperty(Je.prototype,e,{enumerable:!0});class Pe extends Error{node;constructor(e){super("no result"),this.node=e}}function Qe(e){return Object.prototype.hasOwnProperty.call(e,"prototype")}const $e=p({is:e=>"OnConflictNode"===e.kind,create:()=>p({kind:"OnConflictNode"}),cloneWith:(e,t)=>p({...e,...t}),cloneWithIndexWhere:(e,t)=>p({...e,indexWhere:e.indexWhere?Fe.cloneWithOperation(e.indexWhere,"And",t):Fe.create(t)}),cloneWithIndexOrWhere:(e,t)=>p({...e,indexWhere:e.indexWhere?Fe.cloneWithOperation(e.indexWhere,"Or",t):Fe.create(t)}),cloneWithUpdateWhere:(e,t)=>p({...e,updateWhere:e.updateWhere?Fe.cloneWithOperation(e.updateWhere,"And",t):Fe.create(t)}),cloneWithUpdateOrWhere:(e,t)=>p({...e,updateWhere:e.updateWhere?Fe.cloneWithOperation(e.updateWhere,"Or",t):Fe.create(t)}),cloneWithoutIndexWhere:e=>p({...e,indexWhere:void 0}),cloneWithoutUpdateWhere:e=>p({...e,updateWhere:void 0})});class Me{#e;constructor(e){this.#e=p(e)}column(e){const t=Q.create(e);return new Me({...this.#e,onConflictNode:$e.cloneWith(this.#e.onConflictNode,{columns:this.#e.onConflictNode.columns?p([...this.#e.onConflictNode.columns,t]):p([t])})})}columns(e){const t=e.map(Q.create);return new Me({...this.#e,onConflictNode:$e.cloneWith(this.#e.onConflictNode,{columns:this.#e.onConflictNode.columns?p([...this.#e.onConflictNode.columns,...t]):p(t)})})}constraint(e){return new Me({...this.#e,onConflictNode:$e.cloneWith(this.#e.onConflictNode,{constraint:m.create(e)})})}expression(e){return new Me({...this.#e,onConflictNode:$e.cloneWith(this.#e.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new Me({...this.#e,onConflictNode:$e.cloneWithIndexWhere(this.#e.onConflictNode,xt(e))})}whereRef(e,t,r){return new Me({...this.#e,onConflictNode:$e.cloneWithIndexWhere(this.#e.onConflictNode,Ot(e,t,r))})}orWhere(...e){return new Me({...this.#e,onConflictNode:$e.cloneWithIndexOrWhere(this.#e.onConflictNode,xt(e))})}orWhereRef(e,t,r){return new Me({...this.#e,onConflictNode:$e.cloneWithIndexOrWhere(this.#e.onConflictNode,Ot(e,t,r))})}whereExists(e){return new Me({...this.#e,onConflictNode:$e.cloneWithIndexWhere(this.#e.onConflictNode,he(e))})}whereNotExists(e){return new Me({...this.#e,onConflictNode:$e.cloneWithIndexWhere(this.#e.onConflictNode,ce(e))})}orWhereExists(e){return new Me({...this.#e,onConflictNode:$e.cloneWithIndexOrWhere(this.#e.onConflictNode,he(e))})}orWhereNotExists(e){return new Me({...this.#e,onConflictNode:$e.cloneWithIndexOrWhere(this.#e.onConflictNode,ce(e))})}clearWhere(){return new Me({...this.#e,onConflictNode:$e.cloneWithoutIndexWhere(this.#e.onConflictNode)})}doNothing(){return new Ve({...this.#e,onConflictNode:$e.cloneWith(this.#e.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new Ke({...this.#e,onConflictNode:$e.cloneWith(this.#e.onConflictNode,{updates:Ue(e)})})}$call(e){return e(this)}}le(Me,"don't await OnConflictBuilder instances.");class Ve{#e;constructor(e){this.#e=p(e)}toOperationNode(){return this.#e.onConflictNode}}le(Ve,"don't await OnConflictDoNothingBuilder instances.");class Ke{#e;constructor(e){this.#e=p(e)}where(...e){return new Ke({...this.#e,onConflictNode:$e.cloneWithUpdateWhere(this.#e.onConflictNode,xt(e))})}whereRef(e,t,r){return new Ke({...this.#e,onConflictNode:$e.cloneWithUpdateWhere(this.#e.onConflictNode,Ot(e,t,r))})}orWhere(...e){return new Ke({...this.#e,onConflictNode:$e.cloneWithUpdateOrWhere(this.#e.onConflictNode,xt(e))})}orWhereRef(e,t,r){return new Ke({...this.#e,onConflictNode:$e.cloneWithUpdateOrWhere(this.#e.onConflictNode,Ot(e,t,r))})}whereExists(e){return new Ke({...this.#e,onConflictNode:$e.cloneWithUpdateWhere(this.#e.onConflictNode,he(e))})}whereNotExists(e){return new Ke({...this.#e,onConflictNode:$e.cloneWithUpdateWhere(this.#e.onConflictNode,ce(e))})}orWhereExists(e){return new Ke({...this.#e,onConflictNode:$e.cloneWithUpdateOrWhere(this.#e.onConflictNode,he(e))})}orWhereNotExists(e){return new Ke({...this.#e,onConflictNode:$e.cloneWithUpdateOrWhere(this.#e.onConflictNode,ce(e))})}clearWhere(){return new Ke({...this.#e,onConflictNode:$e.cloneWithoutUpdateWhere(this.#e.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#e.onConflictNode}}le(Ke,"don't await OnConflictUpdateBuilder instances.");class He{#e;constructor(e){this.#e=p(e)}values(e){const[t,r]=ve(e);return new He({...this.#e,queryNode:Te.cloneWith(this.#e.queryNode,{columns:t,values:r})})}columns(e){return new He({...this.#e,queryNode:Te.cloneWith(this.#e.queryNode,{columns:p(e.map(Q.create))})})}expression(e){return new He({...this.#e,queryNode:Te.cloneWith(this.#e.queryNode,{values:Kt(e)})})}ignore(){return new He({...this.#e,queryNode:Te.cloneWith(this.#e.queryNode,{ignore:!0})})}onConflict(e){return new He({...this.#e,queryNode:Te.cloneWith(this.#e.queryNode,{onConflict:e(new Me({onConflictNode:$e.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new He({...this.#e,queryNode:Te.cloneWith(this.#e.queryNode,{onDuplicateKey:je.create(Ue(e))})})}returning(e){return new He({...this.#e,queryNode:Ae.cloneWithReturning(this.#e.queryNode,xe(e))})}returningAll(){return new He({...this.#e,queryNode:Ae.cloneWithReturning(this.#e.queryNode,be())})}$call(e){return e(this)}call(e){return this.$call(e)}$if(e,t){return e?t(this):new He({...this.#e})}if(e,t){return this.$if(e,t)}$castTo(){return new He(this.#e)}castTo(){return this.$castTo()}$assertType(){return new He(this.#e)}assertType(){return new He(this.#e)}withPlugin(e){return new He({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){const e=this.compile(),t=e.query,r=await this.#e.executor.executeQuery(e,this.#e.queryId);return this.#e.executor.adapter.supportsReturning&&t.returning?r.rows:[new Je(r.insertId,r.numAffectedRows??r.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Pe){const t=await this.executeTakeFirst();if(void 0===t){throw Qe(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#e.executor.stream(t,e,this.#e.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new He({...this.#e,queryNode:Ae.cloneWithExplain(this.#e.queryNode,e,t)});return await r.execute()}}le(He,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Ge{#n;constructor(e){this.#n=e}get numDeletedRows(){return this.#n}}Object.defineProperty(Ge.prototype,"numDeletedRows",{enumerable:!0});const ze=p({is:e=>"LimitNode"===e.kind,create:e=>p({kind:"LimitNode",limit:_.create(e)})});class Xe{#e;constructor(e){this.#e=p(e)}where(...e){return new Xe({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,xt(e))})}whereRef(e,t,r){return new Xe({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,Ot(e,t,r))})}orWhere(...e){return new Xe({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,xt(e))})}orWhereRef(e,t,r){return new Xe({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,Ot(e,t,r))})}whereExists(e){return new Xe({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,he(e))})}whereNotExists(e){return new Xe({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,ce(e))})}orWhereExists(e){return new Xe({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,he(e))})}orWhereNotExists(e){return new Xe({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,ce(e))})}clearWhere(){return new Xe({...this.#e,queryNode:Ae.cloneWithoutWhere(this.#e.queryNode)})}using(e){return new Xe({...this.#e,queryNode:Se.cloneWithUsing(this.#e.queryNode,zt(e))})}innerJoin(...e){return new Xe({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("InnerJoin",e))})}leftJoin(...e){return new Xe({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("LeftJoin",e))})}rightJoin(...e){return new Xe({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("RightJoin",e))})}fullJoin(...e){return new Xe({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("FullJoin",e))})}returning(e){return new Xe({...this.#e,queryNode:Ae.cloneWithReturning(this.#e.queryNode,xe(e))})}returningAll(e){return new Xe({...this.#e,queryNode:Ae.cloneWithReturning(this.#e.queryNode,be(e))})}orderBy(e,t){return new Xe({...this.#e,queryNode:Se.cloneWithOrderByItem(this.#e.queryNode,me(e,t))})}limit(e){return new Xe({...this.#e,queryNode:Se.cloneWithLimit(this.#e.queryNode,ze.create(e))})}$call(e){return e(this)}call(e){return this.$call(e)}$if(e,t){return e?t(this):new Xe({...this.#e})}if(e,t){return this.$if(e,t)}$castTo(){return new Xe(this.#e)}castTo(){return this.$castTo()}$assertType(){return new Xe(this.#e)}assertType(){return new Xe(this.#e)}withPlugin(e){return new Xe({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){const e=this.compile(),t=e.query,r=await this.#e.executor.executeQuery(e,this.#e.queryId);return this.#e.executor.adapter.supportsReturning&&t.returning?r.rows:[new Ge(r.numAffectedRows??r.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Pe){const t=await this.executeTakeFirst();if(void 0===t){throw Qe(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#e.executor.stream(t,e,this.#e.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new Xe({...this.#e,queryNode:Ae.cloneWithExplain(this.#e.queryNode,e,t)});return await r.execute()}}le(Xe,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Ye{#i;constructor(e){this.#i=e}get numUpdatedRows(){return this.#i}}Object.defineProperty(Ye.prototype,"numUpdatedRows",{enumerable:!0});class Ze{#e;constructor(e){this.#e=p(e)}where(...e){return new Ze({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,xt(e))})}whereRef(e,t,r){return new Ze({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,Ot(e,t,r))})}orWhere(...e){return new Ze({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,xt(e))})}orWhereRef(e,t,r){return new Ze({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,Ot(e,t,r))})}whereExists(e){return new Ze({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,he(e))})}whereNotExists(e){return new Ze({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,ce(e))})}orWhereExists(e){return new Ze({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,he(e))})}orWhereNotExists(e){return new Ze({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,ce(e))})}clearWhere(){return new Ze({...this.#e,queryNode:Ae.cloneWithoutWhere(this.#e.queryNode)})}from(e){return new Ze({...this.#e,queryNode:Ee.cloneWithFromItems(this.#e.queryNode,zt(e))})}innerJoin(...e){return new Ze({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("InnerJoin",e))})}leftJoin(...e){return new Ze({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("LeftJoin",e))})}rightJoin(...e){return new Ze({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("RightJoin",e))})}fullJoin(...e){return new Ze({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("FullJoin",e))})}set(e){return new Ze({...this.#e,queryNode:Ee.cloneWithUpdates(this.#e.queryNode,Ue(e))})}returning(e){return new Ze({...this.#e,queryNode:Ae.cloneWithReturning(this.#e.queryNode,xe(e))})}returningAll(){return new Ze({...this.#e,queryNode:Ae.cloneWithReturning(this.#e.queryNode,be())})}$call(e){return e(this)}call(e){return this.$call(e)}$if(e,t){return e?t(this):new Ze({...this.#e})}if(e,t){return this.$if(e,t)}$castTo(){return new Ze(this.#e)}castTo(){return this.$castTo()}$assertType(){return new Ze(this.#e)}assertType(){return new Ze(this.#e)}withPlugin(e){return new Ze({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){const e=this.compile(),t=e.query,r=await this.#e.executor.executeQuery(e,this.#e.queryId);return this.#e.executor.adapter.supportsReturning&&t.returning?r.rows:[new Ye(r.numAffectedRows??r.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Pe){const t=await this.executeTakeFirst();if(void 0===t){throw Qe(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#e.executor.stream(t,e,this.#e.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new Ze({...this.#e,queryNode:Ae.cloneWithExplain(this.#e.queryNode,e,t)});return await r.execute()}}le(Ze,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const _e=p({is:e=>"CommonTableExpressionNode"===e.kind,create:(e,t)=>p({kind:"CommonTableExpressionNode",name:e,expression:t})}),et=p({is:e=>"CommonTableExpressionNameNode"===e.kind,create:(e,t)=>p({kind:"CommonTableExpressionNameNode",table:w.create(e),columns:t?p(t.map(Q.create)):void 0})});function tt(e,t){const r=t(new ht({executor:yt}));return _e.create(function(e){if(e.includes("(")){const t=e.split(/[\(\)]/),r=t[0],o=t[1].split(",").map((e=>e.trim()));return et.create(r,o)}return et.create(e)}(e),r.toOperationNode())}const rt=p({is:e=>"WithNode"===e.kind,create:(e,t)=>p({kind:"WithNode",expressions:p([e]),...t}),cloneWithExpression:(e,t)=>p({...e,expressions:p([...e.expressions,t])})}),ot=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function nt(){return new it}class it{#s;get queryId(){return void 0===this.#s&&(this.#s=function(e){let t="";for(let r=0;r<e;++r)t+=ot[~~(Math.random()*ot.length)];return t}(8)),this.#s}}class st{nodeStack=[];#a=p({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this)});transformNode(e){if(!e)return e;this.nodeStack.push(e);const t=this.transformNodeImpl(e);return this.nodeStack.pop(),p(t)}transformNodeImpl(e){return this.#a[e.kind](e)}transformNodeList(e){return e?p(e.map((e=>this.transformNode(e)))):e}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",table:this.transformNode(e.table),column:this.transformNode(e.column)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:p([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),expression:this.transformNode(e.expression),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where)}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNode(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}const at=p({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});class dt extends st{#d;#u=new Set;constructor(e){super(),this.#d=e}transformNodeImpl(e){if(!this.#h(e))return super.transformNodeImpl(e);const t=this.#c(e);for(const e of t)this.#u.add(e);const r=super.transformNodeImpl(e);for(const e of t)this.#u.delete(e);return r}transformSchemableIdentifier(e){const t=super.transformSchemableIdentifier(e);return t.schema||!this.#u.has(e.identifier.name)?t:{...t,schema:m.create(this.#d)}}transformReferences(e){const t=super.transformReferences(e);return t.table.table.schema?t:{...t,table:w.createWithSchema(this.#d,t.table.table.identifier.name)}}#h(e){return e.kind in at}#c(e){const t=new Set;if("name"in e&&e.name&&y.is(e.name)&&this.#p(e.name,t),"from"in e&&e.from)for(const r of e.from.froms)this.#l(r,t);if("into"in e&&e.into&&this.#l(e.into,t),"table"in e&&e.table&&this.#l(e.table,t),"joins"in e&&e.joins)for(const r of e.joins)this.#l(r.table,t);return"with"in e&&e.with&&this.#f(e.with,t),t}#l(e,t){const r=w.is(e)?e:g.is(e)&&w.is(e.node)?e.node:null;r&&this.#p(r.table,t)}#p(e,t){this.#u.has(e.identifier.name)||t.add(e.identifier.name)}#f(e,t){for(const r of e.expressions)t.delete(r.name.table.table.identifier.name)}}class ut{#N;constructor(e){this.#N=new dt(e)}transformQuery(e){return this.#N.transformNode(e.node)}async transformResult(e){return e.result}}class ht{#e;constructor(e){this.#e=p(e)}selectFrom(e){return new Dt({queryId:nt(),executor:this.#e.executor,queryNode:de.create(zt(e),this.#e.withNode)})}insertInto(e){return new He({queryId:nt(),executor:this.#e.executor,queryNode:Te.create(Yt(e),this.#e.withNode)})}replaceInto(e){return new He({queryId:nt(),executor:this.#e.executor,queryNode:Te.create(Yt(e),this.#e.withNode,!0)})}deleteFrom(e){return new Xe({queryId:nt(),executor:this.#e.executor,queryNode:Se.create(zt(e),this.#e.withNode)})}updateTable(e){return new Ze({queryId:nt(),executor:this.#e.executor,queryNode:Ee.create(Xt(e),this.#e.withNode)})}with(e,t){const r=tt(e,t);return new ht({...this.#e,withNode:this.#e.withNode?rt.cloneWithExpression(this.#e.withNode,r):rt.create(r)})}withRecursive(e,t){const r=tt(e,t);return new ht({...this.#e,withNode:this.#e.withNode?rt.cloneWithExpression(this.#e.withNode,r):rt.create(r,{recursive:!0})})}withPlugin(e){return new ht({...this.#e,executor:this.#e.executor.withPlugin(e)})}withoutPlugins(){return new ht({...this.#e,executor:this.#e.executor.withoutPlugins()})}withSchema(e){return new ht({...this.#e,executor:this.#e.executor.withPluginAtFront(new ut(e))})}}class ct{#m;#y;#w;constructor(){this.#m=new Promise(((e,t)=>{this.#w=t,this.#y=e}))}get promise(){return this.#m}resolve=e=>{this.#y&&this.#y(e)};reject=e=>{this.#w&&this.#w(e)}}const pt=new Set;function lt(e){pt.has(e)||(pt.add(e),console.log(e))}const ft=p([]);class Nt{#g;constructor(e=ft){this.#g=e}get plugins(){return this.#g}transformQuery(e,t){for(const r of this.#g){const o=r.transformQuery({node:e,queryId:t});if(o.kind!==e.kind)throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${o.kind}`].join(" "));e=o}return e}async executeQuery(e,t){return await this.provideConnection((async r=>{const o=await r.executeQuery(e),n=await this.#W(o,t);return function(e,t){const{numAffectedRows:r}=e;if(void 0===r&&void 0===e.numUpdatedOrDeletedRows||void 0!==r&&void 0!==t.numAffectedRows)return;lt("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}(o,n),n}))}async*stream(e,t,r){const o=new ct,n=new ct;this.provideConnection((async e=>(o.resolve(e),await n.promise))).catch((e=>o.reject(e)));const i=await o.promise;try{for await(const o of i.streamQuery(e,t))yield await this.#W(o,r)}finally{n.resolve()}}async#W(e,t){for(const r of this.#g)e=await r.transformResult({result:e,queryId:t});return e}}class mt extends Nt{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new mt([...this.plugins,e])}withPlugins(e){return new mt([...this.plugins,...e])}withPluginAtFront(e){return new mt([e,...this.plugins])}withoutPlugins(){return new mt([])}}const yt=new mt;function wt(){return new Dt({queryId:nt(),executor:yt,queryNode:de.create(zt([]))})}function gt(e,t){return new fe({joinNode:I.create(e,Xt(t))})}function Wt(e,t,r){if(!U(t)&&!W(t))throw new Error(`invalid binary operator ${JSON.stringify(t)}`);return function(e,t){return("is"===e||"is not"===e)&&(n(t)||o(t))}(t,r)?function(e,t,r){return v.create(H(e),Ct(t),_.createImmediate(r))}(e,t,r):v.create(H(e),Ct(t),ee(r))}function Ot(e,t,r){if(!j(t)&&!W(t))throw new Error(`invalid comparison operator ${JSON.stringify(t)}`);return function(e,t,r){if(!U(t)&&!W(t))throw new Error(`invalid binary operator ${JSON.stringify(t)}`);return v.create(H(e),Ct(t),H(r))}(e,t,r)}function xt(e){return kt("where",e)}function qt(e){return kt("having",e)}function bt(e){return kt("on",e)}function kt(e,t){if(3===t.length)return function(e,t,r){if(!j(t)&&!W(t))throw new Error(`invalid comparison operator ${JSON.stringify(t)}`);return Wt(e,t,r)}(t[0],t[1],t[2]);if(1===t.length)return function(e,t){if(d(t))return vt[e](t);if(W(t)){const e=t.toOperationNode();if(T.is(e))return e}throw It(e,t)}(e,t[0]);throw It(e,t)}function Ct(e){if(t(e)&&D.includes(e))return A.create(e);if(W(e))return e.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(e)}`)}function It(e,t){return new Error(`invalid arguments passed to a '${e}' method: ${JSON.stringify(t)}`)}const vt=p({where(e){const t=wt(),r=Vt(),o=e(Object.assign(t,r)).toOperationNode();if(de.is(o)){if(!o.where)throw new Error("no `where` methods called inside a group callback");return P.create(o.where.where)}return o},having(e){const t=wt(),r=Vt(),o=e(Object.assign(t,r)).toOperationNode();if(de.is(o)){if(!o.having)throw new Error("no `having` methods called inside a group callback");return P.create(o.having.having)}return o},on(e){const t=gt("InnerJoin","table"),r=Vt(),o=e(Object.assign(t,r)).toOperationNode();if(I.is(o)){if(!o.on)throw new Error("no `on` methods called inside a group callback");return P.create(o.on.on)}return o}});function Tt(e,t){if(3===t.length)return function(e,t,r,o){return I.createWithOn(e,Xt(t),Ot(r,"=",o))}(e,t[0],t[1],t[2]);if(2===t.length)return function(e,t,r){const o=r(gt(e,t));return o.toOperationNode()}(e,t[0],t[1]);throw new Error("not implemented")}const Et=p({is:e=>"OffsetNode"===e.kind,create:e=>p({kind:"OffsetNode",offset:_.create(e)})}),Bt=p({is:e=>"GroupByItemNode"===e.kind,create:e=>p({kind:"GroupByItemNode",groupBy:e})});function St(e){return K(e=d(e)?e(Vt()):e).map(Bt.create)}const Ft=p({is:e=>"SetOperationNode"===e.kind,create:(e,t,r)=>p({kind:"SetOperationNode",operator:e,expression:t,all:r})});function Rt(e,t,r){return Ft.create(e,t.toOperationNode(),r)}class Dt{#e;constructor(e){this.#e=p(e)}get expressionType(){}where(...e){return new Dt({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,xt(e))})}whereRef(e,t,r){return new Dt({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,Ot(e,t,r))})}orWhere(...e){return new Dt({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,xt(e))})}orWhereRef(e,t,r){return new Dt({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,Ot(e,t,r))})}whereExists(e){return new Dt({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,he(e))})}whereNotExists(e){return new Dt({...this.#e,queryNode:Ae.cloneWithWhere(this.#e.queryNode,ce(e))})}orWhereExists(e){return new Dt({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,he(e))})}orWhereNotExists(e){return new Dt({...this.#e,queryNode:Ae.cloneWithOrWhere(this.#e.queryNode,ce(e))})}having(...e){return new Dt({...this.#e,queryNode:de.cloneWithHaving(this.#e.queryNode,qt(e))})}havingRef(e,t,r){return new Dt({...this.#e,queryNode:de.cloneWithHaving(this.#e.queryNode,Ot(e,t,r))})}orHaving(...e){return new Dt({...this.#e,queryNode:de.cloneWithOrHaving(this.#e.queryNode,qt(e))})}orHavingRef(e,t,r){return new Dt({...this.#e,queryNode:de.cloneWithOrHaving(this.#e.queryNode,Ot(e,t,r))})}havingExists(e){return new Dt({...this.#e,queryNode:de.cloneWithHaving(this.#e.queryNode,he(e))})}havingNotExist(e){return new Dt({...this.#e,queryNode:de.cloneWithHaving(this.#e.queryNode,ce(e))})}havingNotExists(e){return new Dt({...this.#e,queryNode:de.cloneWithHaving(this.#e.queryNode,ce(e))})}orHavingExists(e){return new Dt({...this.#e,queryNode:de.cloneWithOrHaving(this.#e.queryNode,he(e))})}orHavingNotExists(e){return new Dt({...this.#e,queryNode:de.cloneWithOrHaving(this.#e.queryNode,ce(e))})}select(e){return new Dt({...this.#e,queryNode:de.cloneWithSelections(this.#e.queryNode,xe(e))})}distinctOn(e){return new Dt({...this.#e,queryNode:de.cloneWithDistinctOn(this.#e.queryNode,K(e))})}modifyFront(e){return new Dt({...this.#e,queryNode:de.cloneWithFrontModifier(this.#e.queryNode,q.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new Dt({...this.#e,queryNode:de.cloneWithEndModifier(this.#e.queryNode,q.createWithExpression(e.toOperationNode()))})}distinct(){return new Dt({...this.#e,queryNode:de.cloneWithFrontModifier(this.#e.queryNode,q.create("Distinct"))})}forUpdate(){return new Dt({...this.#e,queryNode:de.cloneWithEndModifier(this.#e.queryNode,q.create("ForUpdate"))})}forShare(){return new Dt({...this.#e,queryNode:de.cloneWithEndModifier(this.#e.queryNode,q.create("ForShare"))})}forKeyShare(){return new Dt({...this.#e,queryNode:de.cloneWithEndModifier(this.#e.queryNode,q.create("ForKeyShare"))})}forNoKeyUpdate(){return new Dt({...this.#e,queryNode:de.cloneWithEndModifier(this.#e.queryNode,q.create("ForNoKeyUpdate"))})}skipLocked(){return new Dt({...this.#e,queryNode:de.cloneWithEndModifier(this.#e.queryNode,q.create("SkipLocked"))})}noWait(){return new Dt({...this.#e,queryNode:de.cloneWithEndModifier(this.#e.queryNode,q.create("NoWait"))})}selectAll(e){return new Dt({...this.#e,queryNode:de.cloneWithSelections(this.#e.queryNode,be(e))})}innerJoin(...e){return new Dt({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("InnerJoin",e))})}leftJoin(...e){return new Dt({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("LeftJoin",e))})}rightJoin(...e){return new Dt({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("RightJoin",e))})}fullJoin(...e){return new Dt({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("FullJoin",e))})}innerJoinLateral(...e){return new Dt({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("LateralInnerJoin",e))})}leftJoinLateral(...e){return new Dt({...this.#e,queryNode:Ae.cloneWithJoin(this.#e.queryNode,Tt("LateralLeftJoin",e))})}orderBy(e,t){return new Dt({...this.#e,queryNode:de.cloneWithOrderByItem(this.#e.queryNode,me(e,t))})}groupBy(e){return new Dt({...this.#e,queryNode:de.cloneWithGroupByItems(this.#e.queryNode,St(e))})}limit(e){return new Dt({...this.#e,queryNode:de.cloneWithLimit(this.#e.queryNode,ze.create(e))})}offset(e){return new Dt({...this.#e,queryNode:de.cloneWithOffset(this.#e.queryNode,Et.create(e))})}union(e){return new Dt({...this.#e,queryNode:de.cloneWithSetOperation(this.#e.queryNode,Rt("union",e,!1))})}unionAll(e){return new Dt({...this.#e,queryNode:de.cloneWithSetOperation(this.#e.queryNode,Rt("union",e,!0))})}intersect(e){return new Dt({...this.#e,queryNode:de.cloneWithSetOperation(this.#e.queryNode,Rt("intersect",e,!1))})}intersectAll(e){return new Dt({...this.#e,queryNode:de.cloneWithSetOperation(this.#e.queryNode,Rt("intersect",e,!0))})}except(e){return new Dt({...this.#e,queryNode:de.cloneWithSetOperation(this.#e.queryNode,Rt("except",e,!1))})}exceptAll(e){return new Dt({...this.#e,queryNode:de.cloneWithSetOperation(this.#e.queryNode,Rt("except",e,!0))})}as(e){return new At(this,e)}clearSelect(){return new Dt({...this.#e,queryNode:de.cloneWithoutSelections(this.#e.queryNode)})}clearWhere(){return new Dt({...this.#e,queryNode:Ae.cloneWithoutWhere(this.#e.queryNode)})}clearLimit(){return new Dt({...this.#e,queryNode:de.cloneWithoutLimit(this.#e.queryNode)})}clearOffset(){return new Dt({...this.#e,queryNode:de.cloneWithoutOffset(this.#e.queryNode)})}clearOrderBy(){return new Dt({...this.#e,queryNode:de.cloneWithoutOrderBy(this.#e.queryNode)})}$call(e){return e(this)}call(e){return this.$call(e)}$if(e,t){return e?t(this):new Dt({...this.#e})}if(e,t){return this.$if(e,t)}$castTo(){return new Dt(this.#e)}castTo(){return this.$castTo()}$assertType(){return new Dt(this.#e)}assertType(){return new Dt(this.#e)}withPlugin(e){return new Dt({...this.#e,executor:this.#e.executor.withPlugin(e)})}toOperationNode(){return this.#e.executor.transformQuery(this.#e.queryNode,this.#e.queryId)}compile(){return this.#e.executor.compileQuery(this.toOperationNode(),this.#e.queryId)}async execute(){const e=this.compile();return(await this.#e.executor.executeQuery(e,this.#e.queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Pe){const t=await this.executeTakeFirst();if(void 0===t){throw Qe(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#e.executor.stream(t,e,this.#e.queryId);for await(const e of r)yield*e.rows}async explain(e,t){const r=new Dt({...this.#e,queryNode:Ae.cloneWithExplain(this.#e.queryNode,e,t)});return await r.execute()}}le(Dt,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class At{#O;#x;constructor(e,t){this.#O=e,this.#x=t}get expression(){return this.#O}get alias(){return this.#x}toOperationNode(){return g.create(this.#O.toOperationNode(),m.create(this.#x))}}class Lt{#q;constructor(e){this.#q=e}get expressionType(){}as(e){return new Ut(this,e)}$castTo(){return new Lt(this.#q)}toOperationNode(){return this.#q}}class Ut{#b;#x;constructor(e,t){this.#b=e,this.#x=t}get expression(){return this.#b}get alias(){return this.#x}toOperationNode(){return g.create(this.#b.toOperationNode(),W(this.#x)?this.#x.toOperationNode():m.create(this.#x))}}const jt=p({is:e=>"AggregateFunctionNode"===e.kind,create:(e,t)=>p({kind:"AggregateFunctionNode",func:e,aggregated:t}),cloneWithDistinct:e=>p({...e,distinct:!0}),cloneWithFilter:(e,t)=>p({...e,filter:e.filter?Fe.cloneWithOperation(e.filter,"And",t):Fe.create(t)}),cloneWithOrFilter:(e,t)=>p({...e,filter:e.filter?Fe.cloneWithOperation(e.filter,"Or",t):Fe.create(t)}),cloneWithOver:(e,t)=>p({...e,over:t})}),Jt=p({is:e=>"FunctionNode"===e.kind,create:(e,t)=>p({kind:"FunctionNode",func:e,arguments:t})});class Pt{#e;constructor(e){this.#e=p(e)}get expressionType(){}as(e){return new Qt(this,e)}distinct(){return new Pt({...this.#e,aggregateFunctionNode:jt.cloneWithDistinct(this.#e.aggregateFunctionNode)})}filterWhere(...e){return new Pt({...this.#e,aggregateFunctionNode:jt.cloneWithFilter(this.#e.aggregateFunctionNode,xt(e))})}filterWhereExists(e){return new Pt({...this.#e,aggregateFunctionNode:jt.cloneWithFilter(this.#e.aggregateFunctionNode,he(e))})}filterWhereNotExists(e){return new Pt({...this.#e,aggregateFunctionNode:jt.cloneWithFilter(this.#e.aggregateFunctionNode,ce(e))})}filterWhereRef(e,t,r){return new Pt({...this.#e,aggregateFunctionNode:jt.cloneWithFilter(this.#e.aggregateFunctionNode,Ot(e,t,r))})}orFilterWhere(...e){return new Pt({...this.#e,aggregateFunctionNode:jt.cloneWithOrFilter(this.#e.aggregateFunctionNode,xt(e))})}orFilterWhereExists(e){return new Pt({...this.#e,aggregateFunctionNode:jt.cloneWithOrFilter(this.#e.aggregateFunctionNode,he(e))})}orFilterWhereNotExists(e){return new Pt({...this.#e,aggregateFunctionNode:jt.cloneWithOrFilter(this.#e.aggregateFunctionNode,ce(e))})}orFilterWhereRef(e,t,r){return new Pt({...this.#e,aggregateFunctionNode:jt.cloneWithOrFilter(this.#e.aggregateFunctionNode,Ot(e,t,r))})}over(e){const t=new ge({overNode:ne.create()});return new Pt({...this.#e,aggregateFunctionNode:jt.cloneWithOver(this.#e.aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}toOperationNode(){return this.#e.aggregateFunctionNode}}le(Pt,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");class Qt{#k;#x;constructor(e,t){this.#k=e,this.#x=t}get expression(){return this.#k}get alias(){return this.#x}toOperationNode(){return g.create(this.#k.toOperationNode(),m.create(this.#x))}}function $t(){const e=(e,t)=>new Lt(Jt.create(e,K(t)));return Object.assign(e,{avg:e=>new Pt({aggregateFunctionNode:jt.create("avg",V(e))}),coalesce:(t,...r)=>e("coalesce",[t,...r]),count:e=>new Pt({aggregateFunctionNode:jt.create("count",V(e))}),countAll:e=>new Pt({aggregateFunctionNode:jt.create("count",be(e)[0])}),max:e=>new Pt({aggregateFunctionNode:jt.create("max",V(e))}),min:e=>new Pt({aggregateFunctionNode:jt.create("min",V(e))}),sum:e=>new Pt({aggregateFunctionNode:jt.create("sum",V(e))})})}function Mt(e=yt){function t(e,t){return new Lt(pe(e,t))}return{get fn(){return $t()},selectFrom:t=>new Dt({queryId:nt(),executor:e,queryNode:de.create(zt(t))}),ref:e=>new Lt(G(e)),val:e=>new Lt(ee(e)),cmpr:(e,t,r)=>new Lt(Wt(e,t,r)),bxp:(e,t,r)=>new Lt(Wt(e,t,r)),unary:t,not:e=>t("not",e),exists:e=>t("exists",e),neg:e=>t("-",e),and(e){if(0===e.length)return new Lt(_.createImmediate(!0));if(1===e.length)return new Lt(e[0].toOperationNode());let t=b.create(e[0].toOperationNode(),e[1].toOperationNode());for(let r=2;r<e.length;++r)t=b.create(t,e[r].toOperationNode());return new Lt(P.create(t))},or(e){if(0===e.length)return new Lt(_.createImmediate(!1));if(1===e.length)return new Lt(e[0].toOperationNode());let t=k.create(e[0].toOperationNode(),e[1].toOperationNode());for(let r=2;r<e.length;++r)t=k.create(t,e[r].toOperationNode());return new Lt(P.create(t))},withSchema:t=>Mt(e.withPluginAtFront(new ut(t)))}}function Vt(e){return Mt()}function Kt(e){if(W(e))return e.toOperationNode();if(d(e))return e(Vt()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(e)}`)}function Ht(e){if(W(e))return e.toOperationNode();if(d(e))return e(Vt()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(e)}`)}function Gt(e){return O(e)||x(e)||d(e)}function zt(e){return l(e)?e.map((e=>Xt(e))):[Xt(e)]}function Xt(e){return t(e)?function(e){const t=" as ";if(e.includes(t)){const[r,o]=e.split(t).map(Zt);return g.create(Yt(r),m.create(o))}return Yt(e)}(e):Ht(e)}function Yt(e){if(e.includes(".")){const[t,r]=e.split(".").map(Zt);return w.createWithSchema(t,r)}return w.create(e)}function Zt(e){return e.trim()}class _t{#e;constructor(e){this.#e=p(e)}get expressionType(){}as(e){return new tr(this,e)}$castTo(){return new _t({...this.#e})}castTo(){return this.$castTo()}withPlugin(e){return new _t({...this.#e,plugins:void 0!==this.#e.plugins?p([...this.#e.plugins,e]):p([e])})}toOperationNode(){return this.#C(this.#I())}compile(e){return this.#v(this.#I(e))}async execute(e){const t=this.#I(e);return t.executeQuery(this.#v(t),this.#e.queryId)}#I(e){const t=void 0!==e?e.getExecutor():yt;return void 0!==this.#e.plugins?t.withPlugins(this.#e.plugins):t}#C(e){return e.transformQuery(this.#e.rawNode,this.#e.queryId)}#v(e){return e.compileQuery(this.#C(e),this.#e.queryId)}}function er(e){return u(e)&&d(e.as)&&d(e.$castTo)&&d(e.withPlugin)&&d(e.toOperationNode)&&d(e.execute)}le(_t,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");class tr{#T;#x;constructor(e,t){this.#T=e,this.#x=t}get expression(){return this.#T}get alias(){return this.#x}toOperationNode(){return g.create(this.#T.toOperationNode(),W(this.#x)?this.#x.toOperationNode():m.create(this.#x))}}const rr=Object.assign(((e,...t)=>new _t({queryId:nt(),rawNode:T.create(e,t?.map(te)??[])})),{ref:e=>new _t({queryId:nt(),rawNode:T.createWithChild(G(e))}),val:e=>new _t({queryId:nt(),rawNode:T.createWithChild(te(e))}),value(e){return this.val(e)},table:e=>new _t({queryId:nt(),rawNode:T.createWithChild(Yt(e))}),id(...e){const t=new Array(e.length+1).fill(".");return t[0]="",t[t.length-1]="",new _t({queryId:nt(),rawNode:T.create(t,e.map(m.create))})},lit:e=>new _t({queryId:nt(),rawNode:T.createWithChild(_.createImmediate(e))}),literal(e){return this.lit(e)},raw:e=>new _t({queryId:nt(),rawNode:T.createWithSql(e)}),join(e,t=rr`, `){const r=new Array(2*e.length-1),o=t.toOperationNode();for(let t=0;t<e.length;++t)r[2*t]=te(e[t]),t!==e.length-1&&(r[2*t+1]=o);return new _t({queryId:nt(),rawNode:T.createWithChildren(r)})}});export{Je as $,c as A,rr as B,Q as C,Oe as D,a as E,h as F,N as G,Vt as H,m as I,lt as J,O as K,x as L,Dt as M,At as N,st as O,He as P,Ae as Q,M as R,y as S,w as T,Ze as U,_ as V,ut as W,Xe as X,Pe as Y,Qe as Z,fe as _,G as a,Ge as a0,Ye as a1,Me as a2,Ve as a3,Ke as a4,Pt as a5,Qt as a6,_t as a7,er as a8,tr as a9,j as aA,J as aB,k as aC,Ne as aD,re as aE,P as aF,Y as aG,Re as aH,de as aI,We as aJ,Ee as aK,Ce as aL,Fe as aM,rt as aN,De as aO,Ie as aP,jt as aQ,ne as aR,oe as aS,ye as aT,v as aU,ue as aV,Be as aW,mt as aa,yt as ab,g as ac,b as ad,Le as ae,_e as af,et as ag,Se as ah,ie as ai,Bt as aj,se as ak,ae as al,I as am,ze as an,Et as ao,$e as ap,je as aq,C as ar,E as as,B as at,S as au,F as av,R as aw,D as ax,L as ay,U as az,$ as b,Yt as c,z as d,T as e,p as f,xt as g,Z as h,W as i,nt as j,Nt as k,d as l,u as m,f as n,ht as o,le as p,$t as q,Te as r,Ft as s,t,A as u,r as v,o as w,n as x,i as y,s as z};
